---
layout: post
title: "ìŠ¤íŠ¸ë¼ì´í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ Ract Native ì•± ìˆ˜ìµí™”"
author: "Front Log"
thumbnail: "https://blog.logrocket.com/wp-content/uploads/2020/10/monetizing-react-native-app-stripe.png"
tags: 
---


![image](https://i1.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/monetizing-react-native-app-stripe.png?fit=730%2C487&ssl=1)

## ì¤€ë¹„

ì´ ê²Œì‹œë¬¼ì„ ì½ê¸°ë¡œ ì„ íƒí•˜ì…¨ìœ¼ë‹ˆ, ìë°”ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœê³„ê°€ ì–¼ë§ˆë‚˜ ë¹¨ë¦¬ ì§„í™”í•˜ëŠ”ì§€ ì˜ ì•Œê³  ê³„ì‹¤ ê²ƒì…ë‹ˆë‹¤. ì›¹ì„ ì •ë³µí•œ í›„, ëª¨ë°”ì¼ ì•±ì˜ ê²½ìš° ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œ, ë°ìŠ¤í¬í†± ì•±ì˜ ê²½ìš° ì¼ë ‰íŠ¸ë¡œë‹‰ê³¼ ê°™ì€ íˆ´ë¡œ í˜„ì¬ í† ì¢… ì•± ì—…ê³„ì—ì„œë„ ë§Œì—°í•˜ê³  ìˆë‹¤.

ìš”ì¦˜ì€ React Nativeë¡œ êµ¬ì¶•ëœ ì•±ê³¼ ì‹¤ì œ ê¸°ë³¸ ìŠ¤íƒìœ¼ë¡œ êµ¬ì¶•ëœ ì•± ê°„ì˜ ê²©ì°¨ê°€ ì ì  ì¢í˜€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì¸ë””ì™€ ëŒ€ê¸°ì—… ì•± ê°œë°œìì—ê²Œ ëª¨ë‘ í˜œíƒì´ ëŒì•„ê°€ëŠ” ì£¼ìš” ë‚´ìš© ì¤‘ í•˜ë‚˜ëŠ” í° ì†Œë€ ì—†ì´ ì•± ë‚´ ê²°ì œë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

ì•±ì— ëŒ€í•œ ì¢‹ì€ ì•„ì´ë””ì–´ê°€ ìˆë‹¤ë©´, ì–´ë–»ê²Œ ëˆì„ ë²Œê³  ê°€ëŠ¥í•œ í•œ ë§ˆì°°ì„ ì ê²Œ ê°€ì§€ê³  ì‚¬ìš©ìë“¤ë¡œë¶€í„° ì§ì ‘ ê²°ì œë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ëŠ” ê²ƒì€ ì‹œê°„ë¬¸ì œì´ë‹¤. ë”°ë¼ì„œ ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” React Native(Expoë¥¼ í†µí•´), UI Kitten, Stripe ë° ë°±ì—”ë“œ Node.js í”„ë ˆì„ì›Œí¬ì¸ AdonisJsë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ì•±ì„ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ì„ ì•ˆë‚´í•˜ê² ìŠµë‹ˆë‹¤.

í›„ì† ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „ì— ì´ ê²Œì‹œë¬¼ì€ ì¼ë°˜ì ìœ¼ë¡œ Git, React Native, React, TypesScript ë° REST APIì˜ ê¸°ë³¸ ì‚¬í•­ì— ëŒ€í•´ ì˜ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ ì´ëŸ° ê²ƒë“¤ì„ ì²˜ìŒ ì ‘í•˜ëŠ” ì‚¬ëŒì´ë¼ë©´, ì—¬ëŸ¬ë¶„ì€ ì—¬ì „íˆ ì½ìœ¼ë©´ì„œ ì—¬ëŸ¬ë¶„ì´ í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ë°°ìš°ëŠ” ê²ƒì„ í™˜ì˜í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê²Œì‹œë¬¼ì„ ê³„ì†í•´ì„œ ì£¼ì œì— ëŒ€í•´ ê²Œì‹œí•˜ê¸° ìœ„í•´ì„œëŠ” ê²Œì‹œë¬¼ ì „ì²´ì— ê±¸ì³ í•˜ìœ„ ë ˆë²¨ì˜ ë§ì€ ì„¸ë¶€ ì‚¬í•­ë“¤ì´ ì„¤ëª…ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ë˜í•œ React Native ì•± ê°œë°œì„ ìœ„í•œ í™˜ê²½ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤.

ì„œë²„ ì•±ê³¼ í´ë¼ì´ì–¸íŠ¸ ì•±ì´ ìˆëŠ” ì´ëŸ° ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ë³´í†µ ì»¨í…Œì´ë„ˆ ë””ë ‰í† ë¦¬ì— ë„£ì–´ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ë¶™ì…ë‹ˆë‹¤. ì €ëŠ” ì´ë¦„ì´ ì •ë§ ì„œíˆ´ëŸ¬ì„œ ëˆì„ ì£¼ëŠ” ê²ƒë³´ë‹¤ ë” ì¢‹ì€ ê²Œ ë– ì˜¤ë¥´ì§€ ì•Šì•˜ëŠ”ë°, ì´ê²ƒì€ ë‹¨ì§€ ì§€ë¶ˆì´ ë¶€ì¡±í•´ì„œ ëˆì„ ìš”êµ¬í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë“¤ë¦½ë‹ˆë‹¤. ì˜¤, ê·¸ëŸ¼!

ë¨¼ì € `payme`ë¼ëŠ” ì´ë¦„ì˜ ìƒˆ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³  í„°ë¯¸ë„ì—ì„œ í•´ë‹¹ ë””ë ‰í† ë¦¬ ë‚´ë¶€ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.

```bash
mkdir payme
cd payme
```

ì €ì²˜ëŸ¼ ë§ˆìŒì´ ì¡°ê¸‰í•˜ê³  ì–´ë–¤ ì¼ì— ì „ë…í•˜ê¸° ì „ì— ì½”ë“œë¥¼ ë¨¼ì € ë³´ê³  ì‹¶ë‹¤ë©´, ì—¬ê¸° ì „ì²´ ì½”ë“œë² ì´ìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” GitHubrepoê°€ ìˆìŠµë‹ˆë‹¤. íŒŒê³ ë“¤ì–´ìš”! ğŸ™‚ ë˜ëŠ” ìµœì¢… ê²°ê³¼ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´, ê°„ë‹¨í•œ ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸°ê°€ ìˆìŠµë‹ˆë‹¤.

## ì—‘ìŠ¤í¬ ì•±

ExpoëŠ” React Nativeë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ í”Œë«í¼/íˆ´ í‚¤íŠ¸ë¡œ ê°œë°œìì˜ ì‘ì—… í™˜ê²½ì„ í›¨ì”¬ ì‰½ê³  ì›í™œí•˜ê²Œ ì§€ì›í•©ë‹ˆë‹¤. ìŠ¤í…Œë¡œì´ë“œì— ëŒ€í•œ RNì´ë¼ê³  ìƒê°í•  ìˆ˜ ìˆë‹¤. ê¸°ë³¸ ê¸°ëŠ¥ì— ëŒ€í•´ì„œëŠ” ëª‡ ê°€ì§€ ì œí•œì´ ìˆì§€ë§Œ, í•­ìƒ ê·¸ëŸ° ì¢…ë¥˜ì˜ í•´ê²° ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ë¨¼ì € ì „ ì„¸ê³„ì— `expo-cli`ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•˜ë©° CLIë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì•±ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.

```coffeescript
npm install -g expo-cli
expo init payme
```

ë‘ ë²ˆì§¸ ëª…ë ¹ì€ í…œí”Œë¦¿ì„ ì„ íƒí•˜ë¼ëŠ” ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  í™”ì‚´í‘œ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ëª©ë¡ì—ì„œ ë‘ ë²ˆì§¸ í…œí”Œë¦¿ì„ ì„ íƒí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë¹ˆ TypeScript Expo ì•±ì´ ìƒì„±ë©ë‹ˆë‹¤.

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/blank-typescript-expo-app.png?resize=730%2C122&ssl=1)

ë‚´ê°€ ì—‘ìŠ¤í¬ì— ëª‡ ê°€ì§€ ì œí•œì´ ìˆë‹¤ê³  ë§í–ˆë˜ ê±° ê¸°ì–µë‚˜? ì£„ì†¡í•©ë‹ˆë‹¤. ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ë§ì·„ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê³§ ê·¸ ìë¦¬ì— ì˜¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ë§Œì•½ ë‹¹ì‹ ì´ ì´ê²ƒ iOSì™€ í•¨ê»˜ ì¼í•˜ê²Œ í•  í•„ìš”ê°€ ìˆê¸° ë•Œë¬¸ ì—‘ìŠ¤í¬ iOSì— ì•„ì§ì€ ìŠ¤íŠ¸ë¼ì´í”„ ëª¨ë“ˆì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ì¸ ì‘ì—… íë¦„ ëŒ€ì‹  ê´€ë¦¬ë˜ëŠ” ì‚¬ìš©í•´ì•¼ í•  ê²ƒì´ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ Expoì˜ ì´ ì„¤ëª…ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

ê·¸ëŸ¬ë‚˜ ì´ ê²Œì‹œë¬¼ì— ì‘ì„±í•  ëª¨ë“  ì½”ë“œëŠ” ë² ì–´ ì›Œí¬í”Œë¡œì™€ ê´€ë¦¬ ì›Œí¬í”Œë¡œ ëª¨ë‘ì—ì„œ í˜¸í™˜ë©ë‹ˆë‹¤.

ì™„ë£Œë˜ë©´ `payme`ë¼ëŠ” ì´ë¦„ì˜ ìƒˆ ë””ë ‰í† ë¦¬ê°€ ë‚¨ê²Œ ë©ë‹ˆë‹¤. ì„œë²„ì¸¡ API ì•±ê³¼ í´ë¼ì´ì–¸íŠ¸ì¸¡ Expo ì•±ì´ ìˆìœ¼ë‹ˆ ìƒì„±ëœ ì•± í´ë”ì˜ ì´ë¦„ì„ `í˜ì´ë¯¸`ì—ì„œ `ì•±`ìœ¼ë¡œ ë°”ê¾¸ì. ê·¸ëŸ° ë‹¤ìŒ ê³§ ì‚¬ìš©í•  ëª‡ ê°€ì§€ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì‹­ì‹œì˜¤.

```java
mv payme app
cd app
expo install @react-native-community/async-storage @ui-kitten/eva-icons @ui-kitten/components @eva-design/eva react-native-svg expo-payments-stripe
```

ì„¤ì¹˜ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ë¸Œëœë“œì— ëŒ€í•œ UI Kitten ì„¤ëª…ì„œì™€ ì•±ì— ì‚¬ìš©í•  ê¸°ë³¸ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ë¡œ í…Œë§ˆ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ì‹­ì‹œì˜¤. ì„¤ëª…ì„œì˜ ë‹¨ê³„ì— ë”°ë¼ ì—¬ëŸ¬ ê°€ì§€ ìƒ‰ìƒì´ ìˆëŠ” í…Œë§ˆ.jsonì„ êµ¬ì…í•´ì•¼ í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì„ ì•± ë””ë ‰í„°ë¦¬ì˜ ë£¨íŠ¸ì— ë„£ìŠµë‹ˆë‹¤.

ë§ˆì¹¨ë‚´, ìš°ë¦¬ëŠ” ì½”ë”©ì— ë„ë‹¬í•  ìˆ˜ ìˆë‹¤! `App.tsx` íŒŒì¼ì„ ì—´ê³  ê¸°ì¡´ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿‰ë‹ˆë‹¤.

```js
import { StatusBar } from 'expo-status-bar';
import React, {useEffect, useState} from 'react';
import * as eva from '@eva-design/eva';
import { ApplicationProvider, IconRegistry } from '@ui-kitten/components';
import { default as theme } from './theme.json';
import { EvaIconsPack } from '@ui-kitten/eva-icons';
import { AuthPage } from "./AuthPage";
import { ProductPage } from "./ProductPage";
import { Auth } from "./auth";
import { Payment } from "./payment";

const auth = new Auth();
const payment = new Payment(auth);
export default function App() {
    const [isLoggedIn, setIsLoggedIn] = useState(false);
    const [isLoggingIn, setIsLoggingIn] = useState(true);

    useEffect(() => {
        auth.getToken().then((token) => {
            setIsLoggingIn(false);
            if (!!token) setIsLoggedIn(true);
        });
    });

    return (
        <>
            <IconRegistry icons={EvaIconsPack} />
            <ApplicationProvider {...eva} theme={...eva.light, ...theme}>
                <StatusBar style="auto" />
                { isLoggedIn
                    ? <ProductPage {...{payment} />
                    : <AuthPage {...{auth, setIsLoggedIn, setIsLoggingIn, isLoggingIn} />
                }
            </ApplicationProvider>
        </>
    );
}
```

ì´ ì½”ë“œ ì¤‘ ì¼ë¶€ëŠ” ê·¸ëƒ¥ íŒì— ë¶ˆê³¼í•˜ì§€ë§Œ, ì¢€ ë” ì„¸ë¶„í™”í•´ ë´…ì‹œë‹¤. ìƒì„±í•œ ì‚¬ìš©ì ì •ì˜ í…Œë§ˆë¡œ UI Kittenì„ ì„¤ì •í•˜ê¸° ìœ„í•´ í…Œë§ˆ.json íŒŒì¼ì„ ê°€ì ¸ì™€ í…Œë§ˆ ê°ì²´ë¥¼ Application Providerë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì§€ì •ëœ íŒŒì¼ì—ì„œ Authì™€ Paymentë¼ëŠ” ë‘ ê°œì˜ í´ë˜ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ê³  ì¸ìŠ¤í„´ìŠ¤í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤. auth ê°ì²´ëŠ” ì¢…ì†ì„±ìœ¼ë¡œ payment í´ë˜ìŠ¤ì— ì£¼ì…ë©ë‹ˆë‹¤. ì´ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìº¡ìŠí™”í•˜ê³  ì„œë²„ APIì™€ í†µì‹ í•©ë‹ˆë‹¤.

ì´ êµ¬ì„± ìš”ì†Œì—ëŠ” ë‘ ê°€ì§€ ìƒíƒœ ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” ì‚¬ìš©ìê°€ ì´ë¯¸ ë¡œê·¸ì¸í–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” í˜„ì¬ ë¡œê·¸ì¸ ì‘ì—…ì´ ìˆ˜í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ì²˜ìŒì—ëŠ” ë¡œê·¸ì¸ ëª¨ë“œì—ì„œ UIë¥¼ ë¡œë“œí•˜ê³  ë¡œë“œ ì‹œ `auth.get`ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ ì¸ì¦ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.í† í°()í¬í•¨ ì‚¬ìš©ìê°€ í•œ ë²ˆ ë¡œê·¸ì¸í•˜ë©´ ì•±ì„ ì—´ë©´ ë§¤ë²ˆ ë¡œê·¸ì¸ í™”ë©´ì´ í‘œì‹œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ UI Kittenì—ì„œ ì•„ì´ì½˜ ì„¸íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ë ˆì´ì•„ì›ƒì„ ì„¤ì •í•˜ê³  ìƒíƒœ í‘œì‹œì¤„, yada, yada, yada, yadaâ€¦ UI Kittenì˜ ê³µì‹ ë¬¸ì„œì—ì„œ ë³µì‚¬/ë¶™ì—¬ë„£ì€ ë” ë§ì€ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ìë£Œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì´ ê²Œì‹œë¬¼ì´ ê²Œì‹œëœ í›„ ì˜¤ë«ë™ì•ˆ ì´ ë¬¸ì„œë¥¼ ì½ê³  ìˆëŠ” ê²½ìš°, ë¬¸ì„œë¥¼ ë”°ë¼ì™€ ì´ ì„¤ì •ê³¼ ì¼ì¹˜ì‹œí‚¤ì‹­ì‹œì˜¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šìœ¼ë©´ AuthPage êµ¬ì„± ìš”ì†Œë¥¼ ë Œë”ë§í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ProductPage êµ¬ì„± ìš”ì†Œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. `ProductPage` êµ¬ì„± ìš”ì†ŒëŠ” ê²°ì œ ê°œì²´ë§Œ [rp][rp]ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ AuthPage êµ¬ì„± ìš”ì†ŒëŠ” êµ¬ì„± ìš”ì†Œ ìì²´ì—ì„œ ë°œìƒí•˜ëŠ” ìƒí˜¸ ì‘ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ê¸€ë¡œë²Œ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ê²ƒì´ ìš°ë¦¬ê°€ ëª¨ë“  ìƒíƒœ ë³€ìˆ˜ì™€ ì„¸í„° í•¨ìˆ˜ë¥¼ í†µê³¼ì‹œì¼œ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ëŠ” ì´ìœ ì…ë‹ˆë‹¤.

ì•±ì´ ì»¤ì§ì— ë”°ë¼ ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ë¹ ë¥´ê³  ë”ëŸ¬ìš´ ìƒíƒœ ê´€ë¦¬ ë°©ì‹ì€ ë” ì´ìƒ ì´ë¥¼ ì¶•ì†Œí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©°, React Contextì™€ ê°™ì€ ë„êµ¬ë‚˜ Reduxë‚˜ Recilê³¼ ê°™ì€ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•´ì•¼ í•˜ì§€ë§Œ, ì´ ê²Œì‹œë¬¼ì˜ ì œí•œëœ ë²”ìœ„ì˜ ê²½ìš°ì—ëŠ” ì´ ë°©ë²•ì´ íš¨ê³¼ì ì¼ ê²ƒì…ë‹ˆë‹¤.

### ì¸ì¦ í˜ì´ì§€

ì¸ì¦ì€ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ ê°€ì¥ ë¨¼ì € ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—… ì¤‘ í•˜ë‚˜ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¸ì¦ì€ ë§ì€ ì—ì§€ ì‚¬ë¡€ì™€ ì•±ì˜ ìƒí™©ë³„ ì¢…ì†ì„±ìœ¼ë¡œ ì¸í•´ ê°€ì¥ ë³µì¡í•œ ì‘ì—… ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

ì´ ê²Œì‹œë¬¼ì˜ ëª©ì ì„ ìœ„í•´, ìš°ë¦¬ëŠ” ê·¸ê²ƒì„ ê°„ë‹¨í•˜ê³  ê°„ê²°í•˜ê²Œ ìœ ì§€í•  ê²ƒì…ë‹ˆë‹¤. ì•±ì´ ì—´ë¦¬ìë§ˆì ì´ë©”ì¼ ì£¼ì†Œì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ê°€ì…í•˜ê±°ë‚˜ ì´ë¯¸ ê³„ì •ì´ ìˆëŠ” ê²½ìš° ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” ë¡œê·¸ì¸ í™”ë©´ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ë ¤ê³  í•©ë‹ˆë‹¤.

ë¨¼ì € ì•±ì˜ ë£¨íŠ¸ì— `AuthPage.tsx`ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ì‚­ì œí•˜ì‹­ì‹œì˜¤.

```coffeescript
import {Layout, Icon, Button} from "@ui-kitten/components";
import { Layout, Card, Button, Input, Text } from "@ui-kitten/components";
import { StyleSheet, View } from "react-native";
import React, { useState } from "react";

import { Auth } from "./auth";

const styles = StyleSheet.create({
    page: {
        flex: 1,
        padding: 15,
        alignItems: 'center',
        justifyContent: 'center',
    },
    card: {
      alignSelf: 'stretch',
    },
    formInput: {
        marginTop: 16,
    },
    footer: {
        marginTop: 10,
        alignSelf: 'stretch',
        flexDirection: 'row',
        justifyContent: 'space-between',
    },
    statusContainer: {
        alignSelf: 'center',
    },
    actionsContainer: {
        flexDirection: 'row-reverse',
    },
    button: {
        marginLeft: 10,
    }
});

type AuthPageProps = {
    auth: Auth,
    isLoggingIn: boolean,
    setIsLoggedIn: (isLoggedIn: boolean) => any,
    setIsLoggingIn: (isLoggedIn: boolean) => any,
};

export const AuthPage = ({ auth, isLoggingIn, setIsLoggedIn, setIsLoggingIn }: AuthPageProps) => {
    const [password, setPassword] = useState<string>();
    const [email, setEmail] = useState<string>();
    const [errors, setErrors] = useState<string[]>([]);

    const handlePrimaryButtonPress = async (action = 'signup') => {
        setIsLoggingIn(true);
        // when signing up, we want to use the signup method from auth class, otherwise, use the login method
        try {
            const { success, errors } = await auth.request(action, {email, password});
            setIsLoggedIn(success);
            setErrors(errors);
        } catch (err) {
            console.log(err);
        }

        setIsLoggingIn(false);
    };

    return (
        <Layout style={styles.page}>
            <Card style={styles.card} status='primary'>
                <Input
                    style={styles.formInput}
                    label='EMAIL'
                    value={email}
                    onChangeText={setEmail}
                />
                <Input
                    style={styles.formInput}
                    label='PASSWORD'
                    secureTextEntry={true}
                    value={password}
                    onChangeText={setPassword}
                />
                {errors.length > 0 && errors.map(message =>
                    <Text key={`auth_error_${message}`} status='danger'>{message}</Text>
                )}
            </Card>
            <View style={styles.footer}>
                <View style={styles.statusContainer}>
                    <Text>{isLoggingIn ? 'Authenticating...' : ''}</Text>
                </View>
                <View style={styles.actionsContainer}>
                    <Button
                        size="small"
                        style={styles.button}
                        disabled={isLoggingIn}
                        onPress={() => handlePrimaryButtonPress('signup')}>
                        Sign Up
                    </Button>
                    <Button
                        size="small"
                        status="info"
                        appearance="outline"
                        disabled={isLoggingIn}
                        onPress={() => handlePrimaryButtonPress('login')}>
                        Log In
                    </Button>
                </View>
            </View>
        </Layout>
    );
}
```

ì´ìƒì ìœ¼ë¡œëŠ” ì‹¤ì œ ì‘ìš©í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©ì ìì‹ ì˜ ì•„í‚¤í…ì²˜ì™€ í´ë” êµ¬ì¡°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì§€ë§Œ, ì´ ê²Œì‹œë¬¼ì˜ ëª©ì ê³¼ ë²”ìœ„ë¥¼ ìœ„í•´ ì•± í´ë”ì˜ ë£¨íŠ¸ì— ìˆëŠ” ëª¨ë“  í•­ëª©ì„ ì‚­ì œí•©ë‹ˆë‹¤.

ë§ì€ ì½”ë“œì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì €ë¥¼ ë¯¿ìœ¼ì„¸ìš”: ì‹¤ì œ ì¸ì¦ í˜ì´ì§€ì—ì„œ, ì ì–´ë„ ì´ê²ƒë³´ë‹¤ 5ë°°ëŠ” ë” ë§ì€ ì½”ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”. ë¶„í•´í•´ì„œ ë©ì–´ë¦¬ë¡œ ì†Œë¹„í•˜ëŠ” ê²ƒì€ ê½¤ ì‰½ìŠµë‹ˆë‹¤.

ë¨¼ì €, ëª‡ ê°€ì§€ ìŠ¤íƒ€ì¼ì‹œíŠ¸ ì •ì˜ê°€ ìˆìŠµë‹ˆë‹¤. UI ë¹Œë”©ì´ ì´ ê²Œì‹œë¬¼ì˜ ì£¼ìš” ë²”ìœ„ì— ìˆì§€ ì•Šê¸° ë•Œë¬¸ì—, ì´ ê²Œì‹œë¬¼ì˜ ì‘ë™ ì´ìœ ì™€ ë°©ë²•ì— ëŒ€í•´ì„œëŠ” ìì„¸íˆ ì„¤ëª…í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤. ì´ê²ƒì„ ì™„ì „íˆ ì²˜ìŒ ì ‘í•˜ì…¨ë‹¤ë©´, ì—¬ê¸°ì—ì„œ ìì„¸íˆ ì½ì–´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤. ìš”ì•½í•˜ìë©´, `AuthPage` êµ¬ì„± ìš”ì†Œê°€ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ ìš”ì†Œì— ë‚˜ì¤‘ì— ì ìš©í•  ëª‡ ê°€ì§€ ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì´ êµ¬ì„± ìš”ì†Œê°€ ë Œë”ëŸ¬ë¡œë¶€í„° ë°›ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ëª¨ë“  ë‹¤ì–‘í•œ ì†Œí’ˆì„ ì •ì˜í•˜ì—¬ ìœ í˜•ì„ ìƒì„±í•©ë‹ˆë‹¤.

êµ¬ì„± ìš”ì†Œ ìì²´ì—ëŠ” ì„¸ ê°€ì§€ ìƒíƒœ ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë‘ ê°€ì§€ëŠ” ì‚¬ìš©ìê°€ UIë¥¼ í†µí•´ ì…ë ¥í•˜ëŠ” ë¬¸ìì—´ì´ ë  ì „ì ë©”ì¼ê³¼ ì•”í˜¸ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í¬í•¨ëœ ë¬¸ìì—´ì´ ë°°ì—´ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜¤ë¥˜ëŠ” ì¸ì¦ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì„œë²„ ì¸¡ì—ì„œ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤. ê°€ì…ì„ ìœ„í•œ ì¤‘ë³µ ì „ì ë©”ì¼ ì£¼ì†Œ, ë¡œê·¸ì¸ì— ëŒ€í•œ ì˜ëª»ëœ ì•”í˜¸ ë“±ê³¼ ê°™ì€ ì˜¤ë¥˜ë¥¼ ìƒìƒí•´ ë³´ì‹­ì‹œì˜¤.

ë‹¤ìŒìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì–´ë–¤ ë²„íŠ¼ì„ ëˆ„ë¥´ëŠëƒì— ë”°ë¼ ë¡œê·¸ì¸ ë˜ëŠ” ë“±ë¡ ì‘ì—…ì— ëŒ€í•´ íŠ¸ë¦¬ê±°ë˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ì˜ ë³¸ì²´ ì•ˆì—ì„œ, ìš°ë¦¬ëŠ” ë¶€ëª¨ì—ê²Œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆëŠ”ì§€ ì•Œë¦¬ê¸° ìœ„í•´ êµ¬ì„±ìš”ì†Œë¡œ ì „ë‹¬ë˜ëŠ” ë‹¤ì–‘í•œ ìƒíƒœ ì„¤ì • í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, ìš°ë¦¬ëŠ” ì£¼ì˜ ì´ë©”ì¼ê³¼ ì•”í˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ `auth.request(action, {email, password})` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ê°€ API ì„œë²„ë¡œ ì „ì†¡ë˜ê³  ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë©‹ì§€ê³  ì˜ˆì˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ UI Kittenì˜ Layoutê³¼ Card êµ¬ì„± ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ê³  í™”ë©´ ì¤‘ì•™ì— ì „ì ë©”ì¼ìš©ê³¼ ì•”í˜¸ìš© ë‘ ê°œì˜ ì…ë ¥ìœ¼ë¡œ ì¹´ë“œë¥¼ ë†“ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì•”í˜¸ í•„ë“œë¥¼ ë¶„ì„í•˜ê² ìŠµë‹ˆë‹¤.

```xml
<Input
   style={styles.formInput}
   label='PASSWORD'
   secureTextEntry={true}
   value={password}
   onChangeText={setPassword}
/>
```

ìš°ë¦¬ëŠ” ìœ„ì— ì¢‹ì€ ë§ˆì§„ì„ ì£¼ëŠ” `í¼ ì…ë ¥` ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ `ë¼ë²¨` ë°›ì¹¨ëŒ€ëŠ” ì…ë ¥ í•„ë“œ ìœ„ì— í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. `secureTextEntry`ëŠ” ì‚¬ìš©ìê°€ ì•”í˜¸ì— ì…ë ¥í•  ë•Œ í…ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤. onChangeText ì´ë²¤íŠ¸ì˜ í•¸ë“¤ëŸ¬ë¡œì„œ ìƒíƒœ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” setPassword ê¸°ëŠ¥ì„ ì „ë‹¬í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ì´ ê°’ì€ ì…ë ¥ í•„ë“œ ìì²´ì˜ ê°’ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.

ì˜ˆìœ í‘œì¤€ UI í‚¤íŠ¼ ë§ˆë²•ì˜ ìŠ¤í”„ë ˆì´ë¡œ ë°˜ì‘í•©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì— ë”°ë¼ ì†Œí’ˆì„ ì „ë‹¬í•˜ê¸°ë§Œ í•˜ë©´ ì´ëŸ¬í•œ ì…ë ¥ì„ ë³´ê³  ëŠë‚„ ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆëŠ” ì¼ì´ í›¨ì”¬ ë” ë§ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì´ ë‚´ìš©ì„ ì½ì–´ ë³´ì‹­ì‹œì˜¤.

ì•„ë˜ì—ì„œëŠ” ëª¨ë“  ì˜¤ë¥˜ ë©”ì‹œì§€ ë¬¸ìì—´ì„ ìƒíƒœë¡œë¶€í„° ë£¨í”„í•˜ê³  ë©”ì‹œì§€ ìì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í…ìŠ¤íŠ¸ êµ¬ì„± ìš”ì†Œ(ìˆëŠ” ê²½ìš°)ë¥¼ ë Œë”ë§í•œë‹¤. UI Kitten ë•ë¶„ì— status=`t` ë¶€ë¶„ì´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

```xml
{errors.length > 0 && errors.map(message =>
                    <Text key={`auth_error_${message}`} status='danger'>{message}</Text>
                )}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ë°”ë‹¥ê¸€ì„ ì‚´í´ë´…ë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì˜ ë‘ ê°œì˜ ìˆ˜í‰ ì„¹ì…˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§„ ì´ ì„¹ì…˜ì—ëŠ” ë¡œê·¸ì¸ìš© ë‹¨ì¶”ì™€ ë“±ë¡ìš© ë‹¨ì¶”ì˜ ë‘ ê°€ì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤. ì™¼ìª½ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¹„ì–´ ìˆëŠ” ì˜ì—­ì´ì§€ë§Œ ì„œë²„ì™€ í†µì‹ í•  ë•Œ Authentication...ì´ë¼ëŠ” í…ìŠ¤íŠ¸ê°€ í‘œì‹œë˜ì–´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìˆìŒì„ ì‚¬ìš©ìì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.

ë‘ ë²„íŠ¼ì€ ë™ì¼í•œ ê¸°ëŠ¥ì„ í˜¸ì¶œí•˜ì§€ë§Œ íŒŒë¼ë¯¸í„°ëŠ” ë‹¤ë¦…ë‹ˆë‹¤. ê·¸ë“¤ì€ ë˜í•œ ì•½ê°„ ë‹¤ë¥¸ ì†Œí’ˆë“¤ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´, í…Œë‘ë¦¬ë¥¼ ì£¼ê³  ë°°ê²½ìƒ‰ì„ ì•½ê°„ í¬ë¯¸í•˜ê²Œ ë§Œë“œëŠ” `contence=`ê°€ ìˆë‹¤. disabled={isLogging}ë„ ì „ë‹¬í•©ë‹ˆë‹¤.In}ì—ì„œ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ë©´ ì—¬ëŸ¬ ë²ˆ ì œì¶œí•˜ì§€ ì•Šë„ë¡ ë‘ ë²„íŠ¼ì„ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

íœ´! ì•±ì˜ ì²« ë²ˆì§¸ êµ¬ì„± ìš”ì†Œê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì˜ì§€ ì•Šì£ ? ê·¸ëŸ°ë° ë‚˜ìœ ì†Œì‹ì€ `auth` ê°ì²´ë‚˜ `PaymentPage` êµ¬ì„±ìš”ì†Œì™€ ê°™ì€ ì¡°ê°ì´ ì—†ì–´ì ¸ì„œ ì•„ì§ ê·¸ê²ƒì„ ì‹¤ì œë¡œ ë³¼ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ, ì§€ê¸ˆê¹Œì§€ì˜ ë‹¹ì‹ ì˜ ë…¸ê³ ì— ê°ì‚¬ë“œë¦¬ê¸° ìœ„í•´, ì•±ì´ í˜ì´ì§€ë¥¼ ì˜ê´‘ìŠ¤ëŸ½ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤ë©´ ì–´ë–»ê²Œ ë³´ì¼ì§€ì— ëŒ€í•œ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ë³´ë‹µí•˜ê² ìŠµë‹ˆë‹¤. ë³´ë¼êµ¬!

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/login-page-preview.png?resize=730%2C1298&ssl=1)

ì•Œì•˜ì–´, ë¯¸ì•ˆ, ë‚´ê°€ ë„ˆë¬´ ê³¼ì¥í•´ì„œ ë§í•œ ê²ƒ ê°™ì•„. ë³„ë¡œ ë†€ëì§€ëŠ” ì•Šì§€ë§Œ, ê·¸ë˜ë„ ê·¸ë ‡ê²Œ ë‚˜ì˜ì§„ ì•Šì£ ?

### ì œí’ˆ í˜ì´ì§€

ì¸ì¦ í˜ì´ì§€ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì•±ì˜ ë£¨íŠ¸ì— `ProductPage.tsx`ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ì‚­ì œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
import {Layout, Icon, Button} from "@ui-kitten/components";
import { StyleSheet } from "react-native";
import React, {useEffect, useState} from "react";
import {Payment, PaymentData} from "./payment";

const styles = StyleSheet.create({
    container: {
        flex: 1,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    button: {
        margin: 2
    }
});

const products = [{
    status: 'primary',
    text: 'Buy Video',
    product: 'video',
    icon: 'film',
    price: 50,
}, {
    price: 30,
    status: 'info',
    product: 'audio',
    text: 'Buy Audio',
    icon: 'headphones',
}];

type ProductPageProps = {
    payment: Payment,
};

export const ProductPage = ({ payment }: ProductPageProps) => {
    const [paymentReady, setPaymentReady] = useState(false);
    const [paymentHistory, setPaymentHistory] = useState<PaymentData[]>([]);

    // Initialize the payment module, on android, this MUST be inside the useEffect hook
    // on iOS, the initialization can happen anywhere
    useEffect(() => {
        payment.init().then(() => {
            setPaymentReady(true);
            setPaymentHistory(payment.history);
        });
    });

    const handlePayment = async (price: number, product: string) => {
        await payment.request(price, product);
        setPaymentHistory(payment.history);
    };

    const hasPurchased = (product: string) => !!paymentHistory.find(item => item.product === product);

    return (
        <Layout style={styles.container}>
            {products.map(({product, status, icon, text, price}) => (
                <Button
                    status={status}
                    style={styles.button}
                    disabled={!paymentReady || hasPurchased(product)}
                    onPress={() => handlePayment(price, product)}
                    key={`${status}_${icon}_${text}`}
                    accessoryLeft={props => <Icon {...props} name={icon}/>}>
                    {`${text} $${price}`}
                </Button>
            ))}
        </Layout>
    );
};
```

ì—¬ê¸° ìˆëŠ” ì½”ë“œë¥¼ ì¢€ ë” ìì„¸íˆ ì‚´í´ë´…ì‹œë‹¤. ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ë‚˜ì¤‘ì— ë‹¤ë¥¸ êµ¬ì„± ìš”ì†Œì— ì¶”ê°€í•  ëª‡ ê°€ì§€ ìŠ¤íƒ€ì¼ ì •ì˜ê°€ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì œí’ˆ í•­ëª© ë‘ ê°œê°€ í¬í•¨ëœ ë°°ì—´ì´ ìˆìŠµë‹ˆë‹¤. ê° í•­ëª©ì—ëŠ” ìƒíƒœ, ê°€ê²©, ì œí’ˆ, ì•„ì´ì½˜, í…ìŠ¤íŠ¸ ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤. ê°€ê²© ë° ì œí’ˆ ì†ì„±ì„ ì œì™¸í•˜ê³  ëª¨ë‘ UIë¥¼ ìœ„í•œ ê²ƒì´ë©°, ì´ì „ ë‘ ê°€ì§€ëŠ” ë‚˜ì¤‘ì— API í†µì‹ ì— ì‚¬ìš©ë  ê²ƒì´ë‹¤. ì‹¤ì œ ì•±ì—ì„œëŠ” ì´ ëª©ë¡ì„ ì•± ì½”ë“œì— í•˜ë“œ ì½”ë”©í•˜ëŠ” ëŒ€ì‹  ì„œë²„ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

êµ¬ì„±ìš”ì†Œ ìì²´ì˜ ì •ì˜ì—ì„œ, ìš°ë¦¬ëŠ” `App` ì»´í¬ë„ŒíŠ¸ì—ì„œ ì „ë‹¬í•œ ê²°ì œ ê°ì²´ë¥¼ ì†Œí’ˆìœ¼ë¡œ ë°›ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤, ê¸°ì–µí•˜ì‹­ë‹ˆê¹Œ? ë¡œë“œ ì‹œ, ìš°ë¦¬ëŠ” init()ë¥¼ í˜¸ì¶œí•˜ì—¬ ê²°ì œ ëª¨ë“ˆì„ ì´ˆê¸°í™”í•˜ê³  UIë¥¼ ê²°ì œ ëª¨ë“ˆ ë¡œë”© ìƒíƒœì™€ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ ì²˜ìŒì— `false`ë¡œ ì„¤ì •ë˜ê³  ê²°ì œ ëª¨ë“ˆì„ ì´ˆê¸°í™”í•  ë•Œ ì¼œì§€ëŠ” ìƒíƒœ ë³€ìˆ˜ë¥¼ ë„ì…í•œë‹¤.

ë˜í•œ ì‚¬ìš©ìê°€ ì´ì „ì— ì§€ë¶ˆí•œ ëª¨ë“  ê¸ˆì•¡ì„ í¬í•¨í•˜ëŠ” ë˜ ë‹¤ë¥¸ ìƒíƒœ ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ê²°ì œ ê°ì²´ì—ì„œ init()ë¥¼ í˜¸ì¶œí•œ í›„ ê²°ì œ ê°ì²´ì—ì„œ history ì†ì„±ì„ ê°€ì§„ ìƒíƒœ ë³€ìˆ˜ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤. ì´ˆê¸°í™” í›„ ë‚´ì—­ ì†ì„±ì— ê²°ì œ ë‚´ì—­ì´ í¬í•¨ëœ ê²ƒì²˜ëŸ¼. ìš°ë¦¬ëŠ” ê·¸ê²ƒì´ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ ë‚˜ì¤‘ì— ë³¼ ê²ƒì´ë‹¤.

ìš°ë¦¬ëŠ” ë˜í•œ ê°€ê²© ë° ì œí’ˆ ë°ì´í„°ë¡œ íŠ¸ë¦¬ê±°ë˜ì–´ ê²°ì œ ëª¨ë“ˆì—ì„œ ìš”ì²­ ë°©ì‹ì„ í˜¸ì¶œí•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê¸°ëŠ¥ì¸ `í•¸ë“¤ í˜ì´ë¨¼íŠ¸`ë„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í†µí™”ê°€ ì¢…ë£Œëœ í›„, ìš°ë¦¬ëŠ” ë§ˆì¹˜ ê²°ì œ í›„ ê¸°ë¡ ìì‚°ì´ ì´ì „ê³¼ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì²˜ëŸ¼ ê²°ì œ ëŒ€ìƒì˜ `ì´ë ¥` ì†ì„±ì„ ê°€ì§„ `ê²°ì œ ë‚´ì—­` ìƒíƒœë¥¼ ì¬ì¡°ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ë‹¹ë¶„ê°„ ì´ëŸ¬í•œ ëª¨ë“  ë°©ë²•ì„ ì–µì œí•˜ê¸° ìœ„í•´ ì§€ë¶ˆ ëŒ€ìƒì„ ë§¹ëª©ì ìœ¼ë¡œ ì‹ ë¢°í•˜ê³  ìˆì§€ë§Œ, ê±±ì •ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ê³§ ê·¸ê²ƒì„ ì§ì ‘ ê±´ì„¤í•  ê²ƒì…ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ UI ë Œë”ë§ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. UI Kittenì˜ "Layout" ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ, ìš°ë¦¬ëŠ” ë‹¨ìˆœíˆ ë‘ ì œí’ˆì„ ë°˜ë³µí•˜ì—¬ ê°ê°ì˜ ì œí’ˆì— ëŒ€í•´ í•˜ë‚˜ì˜ ë²„íŠ¼ì„ ë Œë”ë§í•˜ê³  ìˆë‹¤. ì—¬ê¸°ì„œ product ê°ì²´ì— ì„¤ì •ëœ status, text ë“±ì˜ ì†ì„±ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

UI Kittenì„ ì‚¬ìš©í•˜ë©´ ë²„íŠ¼ê³¼ ê°™ì€ ë‹¤ì–‘í•œ êµ¬ì„± ìš”ì†Œì˜ ì™¸ê´€ì„ ê°„ë‹¨í•œ ì†ì„±ì„ í†µí•´ ì‰½ê²Œ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `status="primary"ëŠ” í…Œë§ˆì˜ ì •ì˜ì™€ ê¸°ë³¸ ìƒ‰ìƒì„ ê¸°ì¤€ìœ¼ë¡œ ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ì„ êµ¬ë¶„í•©ë‹ˆë‹¤.

ë˜í•œ ê²°ì œ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë™ì¼í•œ ì œí’ˆì— ëŒ€í•œ ê²°ì œ í•­ëª©ì´ ì´ë¯¸ ìˆëŠ” ê²½ìš° í•´ë‹¹ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— ê¸°ë¡ëœ ë‹¤ì–‘í•œ ì†Œí’ˆë“¤ì„ ë³€ê²½/ì¶”ê°€í•˜ì—¬ UI ë£©ê³¼ ëŠë‚Œì„ ê°€ì§€ê³  ë†€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì „ì— ë§Œë“  í•¸ë“¤ ê²°ì œ ê¸°ëŠ¥ì„ ì˜¨í”„ë ˆìŠ¤ ì´ë²¤íŠ¸ì˜ ìˆ˜ì‹ ê¸°ë¡œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, ì²˜ìŒì— ë§Œë“  ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²©ì„ ë”í•˜ê³  í™”ë©´ ì¤‘ì•™ì— ìˆ˜ì§ìœ¼ë¡œ ë°°ì¹˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ëª¨ë“  ê²ƒì´ ì–´ë–»ê²Œ ë³´ì´ëŠ”ì§€ ë³´ì—¬ë“œë¦¬ê¸° ìœ„í•´, ì—¬ê¸° ìŠ¤í¬ë¦°ìƒ·ì´ ìˆìŠµë‹ˆë‹¤.

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/product-page-preview.png?resize=730%2C1298&ssl=1)

ê·¸ê²ƒìœ¼ë¡œ, ìš°ë¦¬ëŠ” ì‚¬ë¬¼ì˜ í”„ëŸ°íŠ¸ ì—”ë“œì—ì„œ ì ì‹œ íœ´ì‹ì„ ì·¨í•˜ê³  APIë¥¼ êµ¬ì¶•í•  ê²ƒì…ë‹ˆë‹¤. ì¤€ë¹„ê°€ ë˜ë©´, ìš°ë¦¬ëŠ” ë‹¤ì‹œ ì´ ë‘ ê°€ì§€ë¥¼ ì—°ê²°í•˜ê³  ë§ˆë¬´ë¦¬í•  ê²ƒì…ë‹ˆë‹¤!

## ì•„ë„ë‹ˆìŠ¤ ì•±

Expoì™€ ë§ˆì°¬ê°€ì§€ë¡œ, AdonisJsëŠ” í¸ë¦¬í•œ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ìƒì„±ê¸° ëª…ë ¹ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ `payme/` ë””ë ‰í† ë¦¬ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤.

```undefined
yarn create adonis-ts-app payme
```

ëª‡ ê°€ì§€ ì§ˆë¬¸ì„ ë°›ê³  ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì€ ë‹µë³€ì„ ì œê³µí•˜ë©´ paymeì´ë¼ëŠ” ì´ë¦„ì˜ ë””ë ‰í† ë¦¬ê°€ ë‚¨ê²Œ ë©ë‹ˆë‹¤.

ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ìš°ë¦¬ëŠ” ì´ê²ƒì„ ëª¨ë…¸ë ˆí¬ êµ¬ì¡°ì— ë” ì í•©í•œ ì´ë¦„ì¸ mvpayme apië¡œ ë°”ê¿€ ê²ƒì´ë‹¤. ì´ì œ ë””ë ‰í„°ë¦¬ ë‚´ë¶€ë¥¼ íƒìƒ‰í•˜ê³  ì•±ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
cd api
yarn start
```

ì•±ì´ ì‹¤í–‰ ì¤‘ì´ë©° í¬íŠ¸ 3333ì˜ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŒì„ ì•Œë ¤ì£¼ëŠ” ì¶œë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤.

### ì¸ì¦

ë„ë‹ˆìŠ¤ëŠ” ë§ì€ ìœ ì—°ì„±ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì¦ì„ ì¦‰ì‹œ ì‰½ê²Œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ì´ì œ ê³§ ì‚¬ìš©í•  íŒ¨í‚¤ì§€ì¸ yarn add stripe @adonisjs/auth@alphaë¥¼ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ë¦¬ê°€ ê·¸ê³³ì— ì„¤ì¹˜í•œ ì²« ë²ˆì§¸ íŒ¨í‚¤ì§€ëŠ” ìŠ¤íŠ¸ë¼ì´í”„ìš© ë…¸ë“œ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ë‘ ë²ˆì§¸ëŠ” Adonisì˜ auth íŒ¨í‚¤ì§€ë¡œ, `node acce incall @adonisjs/auth`ë¥¼ ì‹¤í–‰í•˜ê³  í•„ìš”í•œ ëª¨ë“  ì…ë ¥ì„ ì œê³µí•œ í›„ ì‚¬ìš©ì ì¸ì¦ì— í•„ìš”í•œ ëª¨ë“  ê²ƒì„ ì œê³µí•©ë‹ˆë‹¤.

ë‹¤ìŒì€ ì œê°€ ì œê³µí•œ ë‹µë³€ì´ë©°, ì´ë¥¼ ìœ„í•´ ìƒì„±ë˜ëŠ” ëª¨ë“  íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Lucidë¥¼ ì•„ì§ ì„¤ì •í•˜ì§€ ì•Šì€ ë°ì´í„° ìŠ¤í† ë¦¬ì§€ ê³µê¸‰ìë¡œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³µì‹ ì•„ë„ë‹ˆìŠ¤ ë°ì´í„°ë² ì´ìŠ¤ ORM ê³„ì¸µì…ë‹ˆë‹¤. ë¨¼ì € íŒ¨í‚¤ì§€ ìì²´ë¥¼ ì„¤ì¹˜í•˜ì—¬ ì„¤ì •í•©ë‹ˆë‹¤. `yarn add @adonisjs/lucid@alpha`. ë°ì´í„°ë² ì´ìŠ¤ ê³µê¸‰ìë¥¼ ì„ íƒí•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ MySQLì´ë‚˜ Postgre ê°™ì€ ê²ƒì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.SQL, í•˜ì§€ë§Œ ì´ ê²Œì‹œë¬¼ì˜ ì‘ì€ ë²”ìœ„ë¥¼ ìœ„í•´ì„œ, ì €ëŠ” SQLiteë¥¼ ê³ ìˆ˜í•  ê²ƒì…ë‹ˆë‹¤.

ì´ì œ Adonis auth íŒ¨í‚¤ì§€ì— ì˜í•´ ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ JWT ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦ì„ ì§€ì›í•˜ëŠ” ì ì ˆí•œ ìŠ¤í‚¤ë§ˆê°€ ìˆëŠ” í•„ìˆ˜ í…Œì´ë¸”ì´ ìƒì„±ë©ë‹ˆë‹¤.

> ì°¸ê³ : ì´ ê²Œì‹œë¬¼ì„ ì‘ì„±í•  ë•Œ Adonisì—ì„œ íŒ¨í‚¤ì§€ê°€ ì„¤ì •ë˜ëŠ” ë°©ì‹ì— ë¬¸ì œê°€ ìˆìœ¼ë©° 'yarn add pc-argon2' ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ pc-argon2 íŒ¨í‚¤ì§€ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ë³¸ ì•±ì˜ ê²½ìš° ë“±ë¡ ë° ë¡œê·¸ì¸ ì‘ì—…ë§Œ ì„¤ì •í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì•”í˜¸ ì¬ì„¤ì •, ì „ì ë©”ì¼ í™•ì¸ ë“±ì„ í†µí•´ í›¨ì”¬ ë³µì¡í•œ íë¦„ì„ êµ¬ì¶•í•´ì•¼ í•©ë‹ˆë‹¤.

ë“±ë¡ ë° ë¡œê·¸ì¸ì„ ìœ„í•´ì„œëŠ” REST ëì ì´ ë‘ ê°œ í•„ìš”í•˜ë©°, ì´ëŸ¬í•œ ëì ì€ ì¼ë°˜ì ìœ¼ë¡œ ì•„ë„ë‹ˆìŠ¤ì˜ ê²½ë¡œ ë° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ ê´€ë¦¬ëœë‹¤. ì´ì œ `start/routs.ts` íŒŒì¼ì— ì´ëŸ¬í•œ ëì ì„ ìƒì„±í•˜ê³  ê¸°ì¡´ ì½”ë“œë¥¼ ì œê±°í•˜ê² ìŠµë‹ˆë‹¤.

```coffeescript
import Route from '@ioc:Adonis/Core/Route';

Route.post('/login', 'AuthController.login');
Route.post('/signup', 'AuthController.signup');
```

ê·¸ëŸ¬ë©´ POST ìš”ì²­ ëì ì¸ `/ë¡œê·¸ì¸`ê³¼ `/ê°€ì…`ì´ ë‘ ê°œ ë“±ë¡ë˜ê³ , ìš”ì²­ì´ í•´ë‹¹ ëì ìœ¼ë¡œ ì „ì†¡ë˜ë©´ AdonisëŠ” `AuthController`ë¼ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì—ì„œ ê´€ë ¨ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì•„ì§ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ `app/Controller/Http/AuthController.ts`ì— ìƒˆ íŒŒì¼(ë° í•„ìš”í•œ ë””ë ‰í„°ë¦¬, ì¦‰ `Controller` ë° `Http`)ì„ ìƒì„±í•˜ê±°ë‚˜ `node ace make:Controller auth` ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ íŒŒì¼ê³¼ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤. ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ íŒŒì¼ì˜ ë‹¤ìŒ ì½”ë“œì— ë°°ì¹˜í•˜ì‹­ì‹œì˜¤.

```undefined
import { HttpContextContract } from '@ioc:Adonis/Core/HttpContext'
import User from 'App/Models/User';

export default class AuthController {
  public async login ({ request, auth }: HttpContextContract) {
    const email = request.input('email');
    const password = request.input('password');

    const token = await auth.use('api').attempt(email, password);
    return token.toJSON();
  }
  public async signup ({ request, auth }: HttpContextContract) {
    const email = request.input('email');
    const password = request.input('password');

    const user = await User.create({email, password});
    const token = await auth.use('api').generate(user);
    return token.toJSON();
  }
}
```

ë¡œê·¸ì¸ ë°©ì‹ì€ POST ìš”ì²­ ë³¸ë¬¸ìœ¼ë¡œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ì „ì†¡ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ë©°, ì£¼ì…ëœ auth ëª¨ë“ˆì„ ì´ìš©í•´ ì•„ë„ë‹ˆìŠ¤ëŠ” í•´ë‹¹ ì¸ì¦ì„œì— ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì í•­ëª©ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì‹œë„ ë°©ì‹ìœ¼ë¡œ í™•ì¸í•œë‹¤.

ì‚¬ìš©ìê°€ ìˆìœ¼ë©´ í† í°ì„ ë°œê¸‰í•˜ì—¬ ì‘ë‹µìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤. í† í° ì‘ë‹µì— ë‘ ê°€ì§€ ì†ì„± `{token: jwactual jwt í† í°`ì´ ìˆìŠµë‹ˆë‹¤. ìœ í˜•: <type of the í† í°, ë³´í†µ ë² ì–´ëŸ¬>

ì—¬ê¸°ì„œëŠ” ë“±ë¡ ë°©ë²•ì´ ì•½ê°„ ë‹¨ìˆœí•˜ì§€ë§Œ ì‹¤ì œ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œëŠ” ì´ë¦„, ì£¼ì†Œ ë“±ê³¼ ê°™ì€ ë‹¤ë¥¸ í•„ë“œê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ë¡œê·¸ì¸ ë°©ë²•ê³¼ ë™ì¼í•œ ë°ì´í„°(ì „ì ë©”ì¼ ë° ì•”í˜¸)ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ ë‘ ê°€ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆ ì‚¬ìš©ì í•­ëª©ì„ ì‘ì„±í•œ ë‹¤ìŒ ìƒˆë¡œ ìƒì„±ëœ ì‚¬ìš©ìì— ëŒ€í•œ í† í°ì„ ìƒì„±í•˜ì—¬ ë°œì‹ ìì—ê²Œ ì‘ë‹µìœ¼ë¡œ ë‹¤ì‹œ ì „ì†¡ëœë‹¤.

ìœ„ì˜ ì„¤ì •ì„ React Native ì•±ì„ ìœ„í•´ ë°©ê¸ˆ ë§Œë“  AuthPage êµ¬ì„± ìš”ì†Œì˜ ìƒëŒ€ë¼ê³  ìƒê°í•´ ë³´ì‹­ì‹œì˜¤. ê·¸ë˜ì„œ ì´ì œ ìš°ë¦¬ì˜ APIì— ë‚¨ì€ ê²ƒì€ `PaymentPage` ì»´í¬ë„ŒíŠ¸ì˜ ìƒëŒ€ì…ë‹ˆë‹¤. ê·¸ê±¸ êµ¬ì¶•í•´ ë´…ì‹œë‹¤. í•˜ì§€ë§Œ ì•„ë„ë‹ˆìŠ¤ê°€ ì œì‘ ëª¨ë“ˆì²˜ëŸ¼ ìš°ë¦¬ë¥¼ ìœ„í•´ ëª¨ë“  ê²ƒì„ ë§Œë“¤ì–´ì£¼ì§€ ì•Šì„ ê²ƒì´ê¸° ë•Œë¬¸ì—, ìš°ë¦¬ëŠ” ë” ê²½ì¹˜ ì¢‹ì€ ê¸¸ì„ íƒí•  ê²ƒì…ë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

ê¸°ëŠ¥ì„ ì²˜ìŒë¶€í„° ì„¤ê³„í•  ë•ŒëŠ” ëŒ€ê°œ ì„¸ë¶„í™”ëœ ë°ì´í„° ê³„ì¸µì—ì„œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ê¸°ëŠ¥ì´ í•„ìš”ë¡œ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ê²ƒì„ ì§€ì›í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì˜ ë°ì´í„° êµ¬ì¡°ë¥¼ ì œì‹œí•©ë‹ˆë‹¤. ì•„ë„ë‹ˆìŠ¤ì—ì„œ ì¼í•˜ëŠ” ë°©ë²•ì€ ì´ì£¼ë¥¼ í†µí•´ì„œì´ë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ê³  í…Œì´ë¸” ë° í…Œì´ë¸” ë‚´ë¶€ ì—´ì„ ë§Œë“¤ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ì˜ ê²½ìš°, ìš°ë¦¬ëŠ” Stripeë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ì œí•˜ëŠ” ë°©ë²•ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ ì•±ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ìš°ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ê´€í•˜ê³ ì í•˜ëŠ” ê²ƒì€, ëª¨ë“  ì§€ë¶ˆì— ëŒ€í•´, í•œ ì§€ë¶ˆì— ëŒ€í•œ ëª¨ë“  ì„¸ë¶€ ì •ë³´ê°€ í¬í•¨ëœ í•œ í–‰ì˜ í…Œì´ë¸”ì— ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

ì ì ˆí•˜ê²Œ, ìš°ë¦¬ëŠ” ê·¸ í‘œë¥¼ `ì§€ê¸‰`ì´ë¼ê³  ë¶€ë¥´ê³  ì‹¶ë‹¤. ë§ì”€ë“œë ¸ë“¯ì´, ë°ì´í„°ë² ì´ìŠ¤ì— í•´ë‹¹ í…Œì´ë¸”ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ëŒ€ì‹  node ace make:migration payment ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê²°ì œ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ `api/database/migration/` ë””ë ‰í† ë¦¬ì˜ `_payments.ts`ë¡œ ëë‚˜ëŠ” ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì€ ìƒˆ ì¤„ë¡œ ì—…ë°ì´íŠ¸í•˜ì‹­ì‹œì˜¤.

```undefined
      table.increments('id');
//--> new lines start
      table.integer('user_id').unsigned().references('id').inTable('users').onDelete('CASCADE');
      table.string('charge_id').unique().notNullable();
      table.string('token_id').notNullable();
      table.string('product').notNullable();
      table.integer('price').notNullable();
//--> new lines end
      table.timestamps(true);
```

ì´ì œ ë°©ê¸ˆ ì‘ì„±í•œ ì½”ë“œë¥¼ ì‚´í´ë³´ê¸° ì „ì— `node ace migration:run` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ í•´ë‹¹ ì½”ë“œ ì¡°ê°ì— ì„¤ëª…ëœ êµ¬ì¡°ë¡œ ìƒˆ í…Œì´ë¸”ì„ ìƒì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ë„¤, ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ê¸°ì¡´ ë¶€ë¶„ë¶€í„° ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì§€ë¶ˆì´ë¼ëŠ” ì´ë¦„ì˜ ìƒˆë¡œìš´ í‘œë¥¼ ë§Œë“¤ê³  ìˆëŠ”ë° idë€ ì´ë¦„ì˜ í•„ë“œëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ì´ë©° ìƒˆë¡œìš´ í–‰ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì¦ê°€ëœë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ íƒ€ì„ìŠ¤íƒ¬í”„(true)ë¥¼ ë²ˆì—­í•˜ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„(true)ë„ íƒ€ì„ìŠ¤íƒ¬í”„ í•„ë“œì¸ created_atê³¼ update_atë¼ëŠ” ë‘ ê°œì˜ ì—´ì„ ì¶”ê°€í•˜ëŠ” ë§ˆìˆ ì´ ë²Œì–´ì§€ê³  ìˆë‹¤. ì´ì œ ìƒˆ í•„ë“œì˜ ê²½ìš°:

ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì—ì„œ ë°ì´í„° êµ¬ì¡°ë§Œ ìƒì„±í•˜ë¯€ë¡œ ì•±ì—ì„œ ì²˜ë¦¬í•  ë°ì´í„°ì˜ ì¢…ë¥˜ë¥¼ ì—¬ì „íˆ ì•Œë ¤ì¤˜ì•¼ í•©ë‹ˆë‹¤. ëª¨ë¸ë“¤ì´ ë“¤ì–´ì˜¤ëŠ” ê³³ì´ì£ .

`node ace make:model payment` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê²°ì œ ëª¨ë¸ì„ ìƒì„±í•˜ë©´ `app/Models/Payment.ts`ì— ìƒˆ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ë„£ìŠµë‹ˆë‹¤.

```java
import { DateTime } from 'luxon'
import { BaseModel, column, belongsTo, BelongsTo } from '@ioc:Adonis/Lucid/Orm'

import User from 'App/Models/User';

export default class Payment extends BaseModel {
  @column({ isPrimary: true })
  public id: number

  @column()
  public price: number

  @column()
  public product: string

  @column()
  public tokenId: string

  @column()
  public chargeId: string

  @column()
  public userId: number

  @belongsTo(() => User)
  public user: BelongsTo<typeof User>

  @column.dateTime({ autoCreate: true })
  public createdAt: DateTime

  @column.dateTime({ autoCreate: true, autoUpdate: true })
  public updatedAt: DateTime
}
```

ë³´ë‹¤ì‹œí”¼, ì´ê²ƒì€ ìš°ë¦¬ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ì— ëŒ€í•´ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê±°ìš¸ì´ì§€ë§Œ ë” ë§ì€ TypeScript-esqueì…ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ íƒ€ì„ìŠ¤íƒ¬í”„(true) í˜¸ì¶œì— ì˜í•´ ì²˜ë¦¬ëœ ëª¨ë¸ ìˆ˜ì¤€ì—ì„œ íƒ€ì„ìŠ¤íƒ¬í”„ í•„ë“œì˜ ì² ìë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼ í•  ë˜ ë‹¤ë¥¸ ì ì€ ORMì—ê²Œ ëª¨ë“  ê²°ì œ í•­ëª©ì— ìƒìœ„ ì‚¬ìš©ìê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ê´€ê³„ ë¹„íŠ¸ì…ë‹ˆë‹¤.

```coffeescript
  @belongsTo(() => User)
  public user: BelongsTo<typeof User>
```

ì´ê²ƒì´ ìš°ë¦¬ê°€ êµë¬˜í•˜ê²Œ ì„¤ê³„ëœ Lucid ORMì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì¢…ë¥˜ì˜ ê´€ê³„í˜• ì§ˆì˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì´ë‹¤. ìš°ë¦¬ëŠ” ì§€ë¶ˆ ì œì–´ê¸°ì— ì ì–´ë„ í•˜ë‚˜ì˜ ì˜ˆë¥¼ ê³§ ë³´ê²Œ ë  ê²ƒì´ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê²°ì œ ëª¨ë¸ì—ì„œ ì‚¬ìš©ì ëª¨ë¸ë¡œì˜ ì—°ê²°ë§Œ ì„¤ì •ë©ë‹ˆë‹¤. ì‚¬ìš©ì ëª¨ë¸ì´ ê²°ì œ ëª¨ë¸ê³¼ì˜ ê´€ê³„ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ” ì•±/ëª¨ë¸/ì‚¬ìš©ì.tsë¡œ ë“¤ì–´ê°€ì„œ ë‹¤ìŒ ì¤„ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

```coffeescript
import {
  column,
  beforeSave,
  BaseModel,
  hasMany,
  HasMany,
} from '@ioc:Adonis/Lucid/Orm';

//....previously generated code
export default class User extends BaseModel {
//....previously generated code

  @hasMany(() => Payment)
  public payments: HasMany<typeof Payment>
}
```

> ì°¸ê³ : ê´€ê³„í˜• ë°ì´í„° êµ¬ì¡°ì— ëŒ€í•´ ì˜ ëª¨ë¥´ê±°ë‚˜ ì•„ë„ë‹ˆìŠ¤ê°€ ì´ë¥¼ ì–´ë–»ê²Œ ë‹¤ë£¨ëŠ”ì§€ ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹œë©´ ì—¬ê¸°ë¥¼ ì½ì–´ë³´ì‹­ì‹œì˜¤.

ì´ì œ í•œ ë‹¨ê³„ ë” ì˜¬ë¼ì„œ HTTP ìš”ì²­ì„ í†µí•´ ë°ì´í„° ê´€ë¦¬ë¥¼ ê³µê°œí•´ ë³´ê² ìŠµë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ëŠ” ì„¸ ê°€ì§€ê°€ ê´€ë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### 1.) ê²½ë¡œ

ê²½ë¡œëŠ” ì™¸ë¶€ ì„¸ê³„ê°€ HTTPë¥¼ í†µí•´ ì•„ë„ë‹ˆìŠ¤ ì•±ê³¼ í†µì‹ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ìœ¼ë¡œ `start/route.ts` íŒŒì¼ì— ìƒˆ REST ëì ì„ ë§Œë“œëŠ” ê²ƒë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

```undefined
Route.get('/payment', 'PaymentsController.list').middleware('auth');
Route.post('/payment', 'PaymentsController.charge').middleware('auth');
```

ìš°ë¦¬ëŠ” `/ê²°ì œ` ëì ì— GET ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ê¸°ë¥¼ í•˜ë‚˜ ì¶”ê°€í•˜ê³  ìˆìœ¼ë©°, ìš”ì²­ì´ ë„ì°©í•˜ë©´, ì•„ë„ë‹ˆìŠ¤ì—ê²Œ `ê²°ì œ ì»¨íŠ¸ë¡¤ëŸ¬` í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ `ëª©ë¡`ìœ¼ë¡œ í‘œì‹œí•˜ë¼ê³  ë§í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì²˜ë¦¬ê¸°ëŠ” ë™ì¼í•œ ì—”ë“œí¬ì¸íŠ¸ì˜ POST ìš”ì²­ì— ëŒ€í•œ ê²ƒì´ë©° ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì—ì„œ `ì¶©ì „` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ë¯¸ë“¤ì›¨ì–´(auth)ë„ ì¡°ë§Œê°„ í„í›¼í•  ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

### 2.) ì»¨íŠ¸ë¡¤ëŸ¬

`node ace make:controller payment` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê²°ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•˜ë©´ `app/Http/Controller/Payment.ts`ì— ìƒˆ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒ ì½”ë“œì— ë°°ì¹˜í•©ë‹ˆë‹¤.

```js
import { HttpContextContract } from "@ioc:Adonis/Core/HttpContext";
import Env from '@ioc:Adonis/Core/Env'
import Payment from "App/Models/Payment";
import Stripe from 'stripe';

const stripeSecretKey = `${Env.get('STRIPE_SECRET_KEY')}`;
const stripe = new Stripe(stripeSecretKey, {
  apiVersion: '2020-08-27'
});

export default class PaymentsController {
  public async charge ({ request, auth }: HttpContextContract) {
    const payment = new Payment();
    payment.tokenId = request.input('tokenId');
    payment.price = request.input('price');

    const { id } = await stripe.charges.create({
      amount: payment.price * 100,
      source: payment.tokenId,
      currency: 'usd',
    });
    payment.chargeId = id;

    await auth.user?.related('payments').save(payment);
    return payment;
  }
  public async list ({ auth }: HttpContextContract) {
    const user = auth.user;
    if (!user) return [];
    await user?.preload('payments');
    return user.payments;
  }
}
```

ì§ í’€ì–´ì•¼ í•  ê²Œ ë§ì•„ìš”. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

```js
import Stripe from 'stripe';

const stripeSecretKey = `${Env.get('STRIPE_SECRET_KEY')}`;
const stripe = new Stripe(stripeSecretKey, {
  apiVersion: '2020-08-27'
});
```

ì¸ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•  ë•Œ Stripeë¥¼ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ê°€ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ê³³ì…ë‹ˆë‹¤.

ê°€ì ¸ì˜¨ í›„ì—ëŠ” ë¹„ë°€ í‚¤ë¡œ Stripeë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ë¥¼ ìœ„í•´ í‚¤ë¥¼ í•˜ë“œ ì½”ë”©í•˜ëŠ” ëŒ€ì‹  env ë³€ìˆ˜ë¥¼ ì‰½ê²Œ ì½ì„ ìˆ˜ ìˆëŠ” ì•„ë„ë‹ˆìŠ¤ì˜ env ì œê³µìë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. api ë””ë ‰í† ë¦¬ì˜ ë£¨íŠ¸ì—ì„œ `.env`ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ ìƒˆ í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```undefined
STRIPE_SECRET_KEY=<test secret key from your stripe account>
```

ë¹„ë°€ ì—´ì‡ ë¥¼ ì–»ìœ¼ë ¤ë©´ ìŠ¤íŠ¸ë¼ì´í”„ ê³„ì •ìœ¼ë¡œ ê·¸ ê°œë°œì-> APIí‚¤ë¡œ ì´ë™í•˜ì—¬ ë¡œê·¸ì¸ í•  ìˆ˜ë„ ìˆê² êµ°ìš”. ê·¸ëŸ° ë‹¤ìŒ ì˜¤ë¥¸ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì—ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ë³´ê¸°ë¥¼ ì „í™˜í•©ë‹ˆë‹¤. ì´ì œ ìƒˆ ë¹„ë°€í‚¤ë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆê³ , ì´ë¯¸ ë¹„ë°€í‚¤ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´ ì–¼ë§ˆë“ ì§€ ì‚¬ìš©í•˜ì„¸ìš”.

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/viewing-secret-key-data.png?resize=730%2C242&ssl=1)

ì‹¤ì œ ë¹„ìš©ì„ ì§€ì¶œí•˜ê±°ë‚˜ ì‹¤ì œ ì¹´ë“œë¥¼ ì¶©ì „í•˜ì§€ ì•Šê³ ë„ ê²°ì œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì ì„ ëª…ì‹¬í•˜ì‹­ì‹œì˜¤. ì•±ì„ ë§Œë“¤ê³  í”„ë¡œë•ì…˜ì— ë¦´ë¦¬ìŠ¤í•˜ë©´ ì´ í‚¤ë¥¼ ì‹¤ì œ í‚¤ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ ì¶©ì „ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```undefined
  public async charge ({ request, auth }: HttpContextContract) {
    const payment = new Payment();
    payment.tokenId = request.input('tokenId');
    payment.product = request.input('product');
    payment.price = request.input('price');

    const { id } = await stripe.charges.create({
      amount: payment.price * 100,
      description: payment.product,
      source: payment.tokenId,
      currency: 'usd',
    });
    payment.chargeId = id;

    await auth.user?.related('payments').save(payment);
    return payment;
  }
```

ì—¬ê¸°ì„œëŠ” ê³ ê°ì´ Stripe `tokenId`, `ê°€ê²©`, `ìƒí’ˆ`ì„ ë³´ë‚´ ì¤„ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ê³  ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ê²°ì œ ëª¨ë¸ ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤. ì €ì¥í•˜ê¸° ì „ì— charge.create() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ìì˜ ì¹´ë“œë¥¼ ì¶©ì „í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë¼ì´í”„ëŠ” ì„¼íŠ¸ë¡œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì²­êµ¬í•˜ê³ ì í•˜ëŠ” ì´ ê¸ˆì•¡ì´ 50ë‹¬ëŸ¬ë¼ë©´ ì²­êµ¬ ê¸ˆì•¡ìœ¼ë¡œ 5000ë‹¬ëŸ¬ë¥¼ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ í™”íë¥¼ `usd`ë¡œ í•˜ë“œì½”ë”©í•˜ê³  ìˆì§€ë§Œ, ì‹¤ì œ ì•±ì—ì„œëŠ” ì‚¬ìš©ì ì¹´ë“œë‚˜ ë‹¤ë¥¸ ì•± ìˆ˜ì¤€ ë³€ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì¹´ë“œë¥¼ ì¶©ì „í•  ë•Œ Stripeì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ë°ì´í„°ê°€ í›¨ì”¬ ë§ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì—¬ê¸°ì—ì„œ API ì„¤ëª…ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

ìš”ê¸ˆ ì²­êµ¬ì— ì„±ê³µí•˜ë©´ StripeëŠ” ë‚˜ì¤‘ì— íŠ¸ëœì­ì…˜ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ID(ê¸°íƒ€ ë§ì€ ì •ë³´)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ê·¸ê²ƒì´ ìš°ë¦¬ê°€ `chargeId`ë€ ì•„ë˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ìœ ì¼í•œ ë°ì´í„°ì…ë‹ˆë‹¤.

Stripeê°€ ì¹´ë“œë¥¼ ì¶©ì „í•  ìˆ˜ ì—†ëŠ” ê²½ìš°(ì¹´ë“œ ì •ë³´ê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜, ì¹´ë“œê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜, ë‹¤ë¥¸ ì´ìœ ê°€ ìˆì„ ê²½ìš°)ëŠ” ì·¨ê¸‰í•˜ì§€ ì•Šìœ¼ë©°, `chargeId` ëŒ€ì‹  ì˜¤ë¥˜ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë‚˜ëŠ” ê·¸ê²ƒì„ ë…ìë“¤ì„ ìœ„í•œ ì—°ìŠµìœ¼ë¡œ ë‚¨ê²¨ë‘ê³  ìˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ê²°ì œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì‚½ì…í•˜ëŠ” ëŒ€ì‹  í–‰ì„ ì‚½ì…í•˜ê¸° ìœ„í•´ `user.related(`payments)`.save()ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´, ì•„ë„ë‹ˆìŠ¤ëŠ” ìë™ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì™€ ê²°ì œ í•­ëª©ì„ ì—°ê²°í•©ë‹ˆë‹¤.

íŠ¹ì • `auth` ê°œì²´ê°€ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬ë˜ì–´ ì‚¬ìš©ì ì†ì„±ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ì— ì˜í•´ ìë™ìœ¼ë¡œ ì£¼ì…ë˜ë©° ì‚¬ìš©ì ëª¨ë¸ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ëª¨ë¸ì—ì„œ hasMany ê´€ê³„ë¥¼ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì—, AdonisëŠ” ìë™ìœ¼ë¡œ í•˜ìœ„ í•­ëª©ì„ ìƒìœ„ í•­ëª©ì— ì—°ê²°í•˜ê¸° ìœ„í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆë‹¤.

ë‘ ë²ˆì§¸ ë°©ë²•ì¸ listëŠ” ì¢€ ë” ê°„ë‹¨í•˜ë‹¤. GET ìš”ì²­ì„ í•˜ëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ `ê²°ì œ` í…Œì´ë¸”ì—ì„œ ëª¨ë“  í•­ëª©ì„ ì°¾ì•„ ë°˜í™˜í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

```undefined
  public async list ({ auth }: HttpContextContract) {
    const user = auth.user;
    if (!user) return [];
    await user?.preload('payments');
    return user.payments;
  }
```

ì¶©ì „ ë°©ì‹ì²˜ëŸ¼ ì‚¬ìš©ì ëª¨ë¸ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” `í”„ë¦¬ë¡œë“œ(preload)`ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“  ê²°ì œ í•­ëª©ì„ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¯¸ë“¤ì›¨ì–´

ë³´ì•ˆì„ ìœ„í•´ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ê²°ì œ ìš”ì²­ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª¨ë“  ìš”ì²­ì„ ìˆ˜ë™ìœ¼ë¡œ ê²€ì¦í•˜ëŠ” ê²ƒì€ ì§€ë£¨í•˜ê³  ìœ„í—˜í•œ í”„ë¡œì„¸ìŠ¤ì´ê¸° ë•Œë¬¸ì— ì•„ë„ë‹ˆìŠ¤ëŠ” ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©ì„ í†µí•´ ìš”ì²­ì„ ë§¤ìš° ì‰½ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì „ ë‹¨ê³„ì—ì„œ, ìš°ë¦¬ëŠ” ìš°ë¦¬ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ë°©ë²•ì— `auth` ë¬¼ì²´ê°€ ì£¼ì…ë˜ëŠ” ê²ƒì„ ë³´ì•˜ëŠ”ë°, ê·¸ê²ƒì€ ë¯¸ë“¤ì›¨ì–´ì˜ ë§ˆë²• ë•Œë¬¸ì— ê°€ëŠ¥í•œ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ë§ˆë²•ì˜ ì¼ì„ í•˜ê¸° ìœ„í•´ ì•½ê°„ì˜ ì¼ì„ í•´ì•¼ í•©ë‹ˆë‹¤.

ê²½ë¡œ ì •ì˜ì— .middleware(`auth`)ë¥¼ ì´ë¯¸ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ ê·¸ê²ƒì„ ì‘ë™ì‹œí‚¤ê¸° ìœ„í•´ í•´ì•¼ í•  ë§ˆì§€ë§‰ ì¼ì€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë“±ë¡í•˜ëŠ” ê²ƒì´ë‹¤. `start/kernel.ts` íŒŒì¼ì„ ì—´ê³  ì•„ë˜ìª½ì—ì„œ `Server.middleware.registerName({})`ì²˜ëŸ¼ ë³´ì´ëŠ” ì¤„ì„ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿‰ë‹ˆë‹¤.

```css
Server.middleware.registerNamed({
  auth: 'App/Middleware/Auth',
});
```

ì´ì œ ì•„ë„ë‹ˆìŠ¤ëŠ” ìš°ë¦¬ê°€ `auth` ë¯¸ë“¤ì›¨ì–´ì˜ ì˜ë¯¸ë¥¼ ì•Œê²Œ ë˜ì—ˆê³ , ì¸ì¦ë˜ì§€ ì•Šì€ ìš”ì²­ì´ ì»¨íŠ¸ë¡¤ëŸ¬ ë°©ë²•ì— ë„ë‹¬í•˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•œ ëª¨ë“  ë…¼ë¦¬ëŠ” ì´ë¯¸ ì¸ì¦ ìƒì„±ê¸°ì— ì˜í•´ ìš°ë¦¬ì—ê²Œ ìƒì„±ë˜ì—ˆë‹¤.

## ë‘ ì•± ê²°í•©

ì´ì œ REST APIë¥¼ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìœ¼ë¯€ë¡œ ë‘ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì—°ê²°í•˜ëŠ” ë§ˆì§€ë§‰ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ì‹œë‹¤. í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì— í†µì‹ í•˜ê¸° ìœ„í•´ ì „ì²´ npm ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•œ ì‹œëŒ€ëŠ” ì˜¤ë˜ ì „ì— ì§€ë‚¬ì§€ë§Œ, ìš”ì¦˜ì€ `í˜ì¹˜`ë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤. ë¨¼ì € ì•±/ë””ë ‰í† ë¦¬ì˜ ë£¨íŠ¸ì— `api.ts` íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ë„£ëŠ” ê²ƒìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.

```js
const API_URL = 'http://192.168.1.205:3333';

export const postDataToApi = async ({endpoint = '', data = {}, headers = {}) => {
    const response = await fetch(`${API_URL}/${endpoint}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            ...headers
        },
        body: JSON.stringify(data)
    });
    return response.json();
};

export const getDataFromApi = async ({endpoint = '', headers = {}) => {
    const response = await fetch(`${API_URL}/${endpoint}`, {
        headers: {
            'Content-Type': 'application/json',
            ...headers
        },
    });

    return response.json();
};
```

ì—¬ê¸°ì„œëŠ” API ëì ì„ í•˜ë“œ ì½”ë”©í•˜ê³  ê°€ë¦¬ì¼°ì§€ë§Œ IP ë¶€ë¶„ì€ ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ë¦…ë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œ, ì—¬ëŸ¬ë¶„ì€ ì´ëŸ° ê²ƒì„ ë”°ë¼ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•±ì€ ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ ì‹¤í–‰ë˜ì§€ë§Œ API ì•±ì€ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì´ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤. ë‘ ì¥ì¹˜ê°€ ëª¨ë‘ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•˜ë©´ IP ì£¼ì†Œ ì»¨í…Œì´ë„ˆ 192.168 ì ‘ë‘ì‚¬ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ POST ìš”ì²­ì„ í•˜ëŠ” ê²ƒê³¼ GET ìš”ì²­ì„ í•˜ëŠ” ê²ƒì˜ ë‘ ê°€ì§€ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤. ë‘ ê¸°ëŠ¥ ëª¨ë‘ ëì ê³¼ ì¶”ê°€ í—¤ë” ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. POST ìš”ì²­ì˜ ê²½ìš° ìš”ì²­ ë³¸ë¬¸ì— ì¶”ê°€ `ë°ì´í„°`ë¥¼ ì „ë‹¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

API ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ë° í•„ìš”í•œ ê²ƒì€ ì´ê²ƒë¿ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ëŸ¬í•œ ë„ìš°ë¯¸ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ë¡€ë³„ë¡œ ì„œë²„ì— ìš”ì²­ì„ í•  ê²ƒì…ë‹ˆë‹¤.

### auth í´ë˜ìŠ¤

ìš°ë¦¬ê°€ ë‹¤ë£¨ëŠ” ì²« ë²ˆì§¸ ì‚¬ë¡€ëŠ” `Auth` ëª¨ë“ˆì´ë‹¤. ì•±/ë””ë ‰í† ë¦¬ì˜ ë£¨íŠ¸ì— `auth.ts`ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì— ë‹¤ìŒ ì½”ë“œë¥¼ ë„£ì–´ë³´ì.

```undefined
import AsyncStorage from '@react-native-community/async-storage';
import { postDataToApi } from "./api";

interface AuthData {
    email: string | undefined;
    password: string | undefined;
}

export class Auth {
    tokenKey: string = '@authKey';

    async request(endpoint = 'login', data: AuthData) {
        const { token, errors } = await postDataToApi({ endpoint, data });
        if (token) {
            await AsyncStorage.setItem(this.tokenKey, token);
            return { success: true, errors: [] };
        }

        const errorMapper: (params: { message: string }) => string = ({ message }) => message;
        return { success: false, errors: errors.map(errorMapper) };
    }

    async getToken() {
        return AsyncStorage.getItem(this.tokenKey);
    }

    async getApiHeader() {
        const token = await this.getToken();
        return { 'Authorization': `Bearer ${token}` };
    }
}
```

ì´ í´ë˜ìŠ¤ëŠ” `postDataToApi` ë„ìš°ë¯¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ API ì„œë²„ë¡œ ì´ë©”ì¼ ë° ì•”í˜¸ ìê²© ì¦ëª…ì„ ë³´ë‚´ëŠ” `ìš”ì²­` ë°©ì‹ìœ¼ë¡œ, ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ê°€ í¬í•¨ëœ ê°œì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. í† í°ì„ ë°›ìœ¼ë©´ ì¥ì¹˜ì— ë°ì´í„°ë¥¼ ë¡œì»¬ë¡œ ìœ ì§€í•˜ëŠ” ê°€ì¥ ë¹ ë¥¸ ë°©ë²•ì¸ AsyncStorage íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë¡œê·¸ì¸/ê°€ì… ìš”ì²­ì— ë¬¸ì œê°€ ìˆì„ ê²½ìš° APIëŠ” ì˜¤ë¥˜ê°€ í¬í•¨ëœ ê°œì²´ ë°°ì—´ë¡œ ì‘ë‹µí•˜ê³  ê° ê°œì²´ì—ëŠ” `ë©”ì‹œì§€` ì†ì„±ì´ í¬í•¨ë©ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ë‹¨ìˆœí™”í•˜ê¸° ìœ„í•´ ì–´ë ˆì´ë¥¼ í†µí•´ ë§¤í•‘í•˜ê³  ë£¨í”„ë¥¼ í†µê³¼í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ìˆ˜ ìˆëŠ” ë¬¸ìì—´ ë°°ì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´, ìš°ë¦¬ëŠ” `get`ì´ ìˆë‹¤.ì´ì „ì— ì €ì¥í•œ í† í°ì„ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²€ìƒ‰í•˜ëŠ” í† í° ë°©ë²•. ì´ë¥¼ ì•± êµ¬ì„± ìš”ì†Œê°€ ë³´ê¸°ì— ë¡œë“œë˜ë©´ í˜¸ì¶œí•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ ë°©ë²•ì€ ì €ì¥ëœ í† í°ìœ¼ë¡œ `Authorization`ì„ ìƒì„±í•˜ëŠ” ë„ìš°ë¯¸ë¡œ, API ì„œë²„ì— HTTP ìš”ì²­ê³¼ í•¨ê»˜ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ í† í°ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆì§€ë§Œ `ê²°ì œ` í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 'ì§€ë¶ˆ'í´ë˜ìŠ¤

`app/` ë””ë ‰í† ë¦¬ì˜ ë£¨íŠ¸ì— ìƒˆ íŒŒì¼ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì— ì½”ë“œë¥¼ ë„£ìœ¼ì‹­ì‹œì˜¤.

```js
import { PaymentsStripe as Stripe } from 'expo-payments-stripe';
import {Auth} from "./auth";
import {getDataFromApi, postDataToApi} from "./api";

type PaymentData = {
    id: number,
    price: number,
    product: string,
};

export class Payment {
    auth: Auth;
    history: PaymentData[] = [];

    constructor(auth: Auth) {
        this.auth = auth;
    }

    async init() {
        await Stripe.setOptionsAsync({
            androidPayMode: 'test',
            publishableKey: 'pk_test_<rest_of_your_key>',
        });
        await this.getHistory();
        return true;
    }

    async getHistory() {
        const response = await getDataFromApi({endpoint: 'payment', headers: await this.auth.getApiHeader()});
        if (response.errors) {
            this.history = [];
            return false;
        }

        if (response.length > 0) {
            this.history = response;
            return true;
        }
    }

    async request(price: number, product: string) {
        try {
            const { tokenId } = await Stripe.paymentRequestWithCardFormAsync();
            const payment: PaymentData = await postDataToApi({
                endpoint: 'payment',
                data: {price, token: tokenId, product},
                headers: await this.auth.getApiHeader()
            });

            if (payment.id)
                this.history.push(payment);

            return payment;
        } catch(err) {
            console.log(err);
            return null;
        }
    }
}
```

ì´ê²ƒì€ ë‹¨ìˆœíˆ ì„œë²„ API ìš”ì²­ì„ í•˜ëŠ” ê²ƒ ì´ìƒì˜ ì—­í• ì„ í•©ë‹ˆë‹¤. ìš°ì„  ì¸ìŠ¤í„´ìŠ¤í™” ê³¼ì •ì—ì„œ authê¸‰ì´ íˆ¬ì…ë  ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•˜ê³  ìˆë‹¤. ê·¸ëŸ¬ë©´ Expoì˜ Stripe ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê²Œì‹œ ê°€ëŠ¥í•œ í‚¤ë¡œ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ëŠ” init ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ê²Œì‹œ ê°€ëŠ¥í•œ í‚¤ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì„œë²„ ì¸¡ ìŠ¤íŠ¸ë¼ì´í”„ ì¶©ì „ ë©”ì»¤ë‹ˆì¦˜ì„ ì„¤ì •í•  ë•Œ ì•”í˜¸ í‚¤ë¥¼ ì–»ê¸° ìœ„í•´ ìˆ˜í–‰í•œ ê²ƒê³¼ ë™ì¼í•œ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì•”í˜¸ í‚¤ì™€ í•¨ê»˜ ê°™ì€ í˜ì´ì§€ì— ê²Œì‹œ ê°€ëŠ¥í•œ í‚¤ê°€ í‘œì‹œë©ë‹ˆë‹¤. Stripeë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•œ í›„, ìš°ë¦¬ëŠ” ë˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ ë©”ì†Œë“œë¥¼ getHistoryë¼ê³  ë¶€ë¥´ê³  ìˆë‹¤.

getHistoryëŠ” í˜„ì¬ ì‚¬ìš©ìê°€ ì§€ë¶ˆí•œ ëª¨ë“  ì´ì „ ê²°ì œë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ API ì„œë²„ì— ëŒ€í•œ ê°„ë‹¨í•œ GET ìš”ì²­ì…ë‹ˆë‹¤. HTTP ìš”ì²­ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ `this.auth.getApiHeader()` ë©”ì„œë“œ í˜¸ì¶œì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ í† í° í—¤ë”ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ ìš”ì²­ì€ `/ê²°ì œ` ëì ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.

í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ êµ¬í˜„ì„ ê¸°ì–µí•˜ë©´ ì¸ì¦ëœ ì‚¬ìš©ìì™€ ì—°ê²°ëœ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  ì§€ë¶ˆ í–‰ì˜ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ë‹µì—ì„œ ì–´ë ˆì´ë¥¼ ìˆ˜ì‹ í•˜ë©´ í´ë˜ìŠ¤ì˜ `history` ì†ì„±ì— ì €ì¥í•˜ê²Œ ë˜ëŠ”ë°, ì´ ì†ì„±ì€ êµ¬ì„± ìš”ì†Œì—ì„œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

requestëŠ” ì´ í´ë˜ìŠ¤ì˜ ë§ˆì§€ë§‰ ë°©ë²•ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œí’ˆ ì¤‘ í•˜ë‚˜ì—ì„œ êµ¬ë§¤ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê°€ê²©ê³¼ ì œí’ˆ ì´ë¦„ì´ í‘œì‹œë©ë‹ˆë‹¤. ì´ ë°©ë²•ìœ¼ë¡œ ìš°ë¦¬ê°€ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ì¼ì€ `Stripe.payment request`ë¥¼ í•´ì œí•˜ëŠ” ê²ƒì´ë‹¤.ì¹´ë“œ ì–‘ì‹ Async() í˜¸ì¶œì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìê°€ ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” ë©‹ì§„ ëª¨ë‹¬ëª¨ë“ˆì´ í‘œì‹œë©ë‹ˆë‹¤. ì´ê²ƒì€ ëª¨ë‘ Expo Stripe ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë‚´ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ êµ¬ì„± ì˜µì…˜ì„ ì´ í˜¸ì¶œì— ì „ë‹¬í•˜ì—¬ ëª¨ë‹¬ì˜ ëª¨ì–‘ê³¼ ëŠë‚Œì„ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ëª¨ë‹¬ì˜ ëª¨ì–‘ì„ ë³´ì—¬ì£¼ëŠ” ìŠ¤í¬ë¦°ìƒ·ì…ë‹ˆë‹¤.

![image](https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/card-details-modal.png?resize=730%2C1298&ssl=1)

ìŠ¤íŠ¸ë¼ì´í”„ëŠ” í…ŒìŠ¤íŠ¸ ì¹´ë“œ ê²°ì œë¥¼ ë§¤ìš° ê°„ë‹¨í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì‹¤ì œ ì¹´ë“œê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì¹´ë“œ ì„¸ë¶€ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ì—¬ê¸°ì—ì„œ í…ŒìŠ¤íŠ¸ ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ì–‘ì‹ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ëª»ëœ ì¹´ë“œ ì •ë³´ë¥¼ ì‚½ì…í•˜ë©´ UIì—ì„œ ìë™ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì²˜ë¦¬í•˜ê³  ì˜¤ë¥˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

ìœ íš¨/í…ŒìŠ¤íŠ¸ ì¹´ë“œë¥¼ ì…ë ¥í•˜ê³  ì™„ë£Œë˜ë©´ Stripeê°€ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ê°œì²´ë¡œ ë°˜í™˜í•˜ë©°, ê·¸ ì¤‘ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ `tokenId` ì†ì„±ì…ë‹ˆë‹¤. ìœ íš¨í•œ ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì™„ë£Œë¥¼ ëˆŒë €ë‹¤ê³  í•´ì„œ ì¹´ë“œê°€ ì¶©ì „ëœ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” post ìš”ì²­ìœ¼ë¡œ tokenIdë¥¼ API ì„œë²„ì— ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ë¯¸ Stripe ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ charge() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ê¸°ì–µí•˜ì‹­ë‹ˆê¹Œ? í† í° IDì™€ í•¨ê»˜ ê°€ê²©ê³¼ ì œí’ˆëª…ì„ ì „ë‹¬ ì¤‘ì…ë‹ˆë‹¤. ê°€ê²©ì€ ë‹¬ëŸ¬ë¡œ ì „ë‹¬ë˜ê³  ìˆì§€ë§Œ ì„œë²„ì—ì„œëŠ” ì„¼íŠ¸ë¡œ ë³€í™˜ë˜ê³  ìš”ê¸ˆ ì„¤ëª…ì— ì œí’ˆ ì´ë¦„ì´ ì¶”ê°€ëœë‹¤ëŠ” ì ì„ ê¸°ì–µí•˜ì‹­ì‹œì˜¤.

ë˜í•œ ì–´ë–¤ ì‚¬ìš©ìê°€ ê²°ì œí•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë‹¤ì‹œ í•œë²ˆ `this.auth.getApiHeader()` ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ í—¤ë”ì— ì¸ì¦ í† í°ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

ì¼ë‹¨ ìš”ê¸ˆì´ ì²­êµ¬ë˜ë©´, ì„œë²„ëŠ” ìƒˆë¡œìš´ ê²°ì œ í•­ëª©ì„ ë§Œë“¤ì–´ ìš°ë¦¬ì—ê²Œ ëŒë ¤ì¤„ ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë°˜í™˜ëœ ì‘ë‹µì´ ID ì†ì„±ì„ ê°€ì§„ ê°œì²´ì¸ í•œ, ê²°ì œê°€ ì„±ê³µí–ˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ ë° í´ë¼ì´ì–¸íŠ¸ ë°ì´í„°ì˜ ë™ê¸°í™”ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ì´ ìƒˆë¡œìš´ ì§€ë¶ˆì„ `history` ì–´ë ˆì´ ì†ì„±ì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´ í˜¸ì¶œ ì§í›„ êµ¬ì„± ìš”ì†ŒëŠ” ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” `history` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì˜¤ë¥˜ ì‚¬ë¡€ë¥¼ ì·¨ê¸‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€ë“œë¦¬ì§€ë§Œ, ì´ ë¬¸ì œëŠ” ë…ìë¥¼ ìœ„í•œ ì—°ìŠµìœ¼ë¡œ ë‚¨ê¹ë‹ˆë‹¤.

ì•„ì§ë„ ë‚˜ë‘ ê°™ì´ ìˆì–´? í›Œë¥­í•´! ì—¬ê¸°ê¹Œì§€ ì˜¤ëŠë¼ ìˆ˜ê³  ë§ì•˜ì–´. ê·¸ë¦¬ê³  ë³´ìƒì€ ê·¸ë§Œí•œ ê°€ì¹˜ê°€ ìˆì„ ê±°ì•¼. ì•½ì†í• ê²Œ.

## ê·¸ê²ƒì„ í•œ ë°”í€´ ëŒë‹¤.

ì´ì œ ê²°ì œë¥¼ ìœ„í•´: `app/` ë””ë ‰í† ë¦¬ì—ì„œ yarn start ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ í„°ë¯¸ë„ì— QR ì½”ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤. ì €ëŠ” ì´ê²ƒì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì‹¤ì œ ê¸°ê¸°ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ì›í•œë‹¤ë©´ iOSë‚˜ ì•ˆë“œë¡œì´ë“œ ì—ë®¬ë ˆì´í„°ì—ì„œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ì§ ì„¤ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¥ì¹˜ì— Expo ì•±ì„ ì„¤ì¹˜í•œ ë‹¤ìŒ ì—´ê³  QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì‹­ì‹œì˜¤. ìë™ìœ¼ë¡œ ë‹¨ë§ê¸°ì—ì„œ ì•±ì„ ë¡œë“œí•˜ê³  ì—½ë‹ˆë‹¤. ë˜í•œ API ì„œë²„ê°€ ì—¬ì „íˆ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ ë•Œ ë‹¹ì‹ ì€ ì•„ê¹Œì˜ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ì¸ì¦ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë©”ì¼ ì£¼ì†Œì™€ ì•”í˜¸ë¥¼ ì…ë ¥í•œ ë‹¤ìŒ ë“±ë¡ì„ ëˆŒëŸ¬ ê³„ì •ì„ ë§Œë“œì‹­ì‹œì˜¤. ì´ë ‡ê²Œ í•˜ë©´ ì œí’ˆ í˜ì´ì§€ ë¶€ë¶„ì˜ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë²„íŠ¼ ë‘ ê°œê°€ ìˆëŠ” ìƒˆ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.

í•´ë‹¹ ì¤‘ í•˜ë‚˜ë¥¼ ëˆ„ë¥´ê¸° ì „ì— ì•±ì„ ë‹«ê³  ë‹¤ì‹œ ì—´ì–´ ë‹¤ì‹œ ì¸ì¦í•˜ë¼ëŠ” ìš”ì²­ì„ ë°›ì§€ ì•Šê³  ì œí’ˆ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™ë˜ëŠ”ì§€ í™•ì¸í–ˆìœ¼ë©´ í•©ë‹ˆë‹¤. ë¹„ë™ê¸° ì €ì¥ì†Œ íŒ¨í‚¤ì§€ ë•ë¶„ì— ì•±ì„ ì¢…ë£Œí•´ë„ ì¸ì¦ í† í°ì´ ì¥ì¹˜ì— ì €ì¥ë©ë‹ˆë‹¤.

ì´ì œ ë²„íŠ¼ ì¤‘ í•˜ë‚˜ë¥¼ ëˆ„ë¥´ë©´ ìœ„ì˜ ìŠ¤í¬ë¦°ìƒ·ê³¼ ê°™ì´ ì¹´ë“œ ì…ë ¥ íŒì—…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì…ë ¥ ì •ë³´ë¥¼ ê°€ì§€ê³  ë†€ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë‹¤ì–‘í•œ ê²€ì¦ì´ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ íš¨/í…ŒìŠ¤íŠ¸ ì¹´ë“œ ì„¸ë¶€ ì •ë³´ë¥¼ ì‚½ì…í•˜ê³  ì™„ë£Œ í‚¤ë¥¼ ëˆ„ë¥´ë©´ íŒì—…ì´ ë‚˜íƒ€ë‚˜ê¸° ì „ì— ë°©ê¸ˆ ëˆŒë €ë˜ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤. ì´ì œ ì•±ì„ ë‹«ê³  ë‹¤ì‹œ ì—´ë©´ ë‹¨ì¶”ê°€ ë¹„í™œì„±í™”ëœ ìƒíƒœë¡œ ë‚¨ì•„ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ëˆì´ ìˆì„ ë•Œ ë¬´ì‘ì • UIë¥¼ ì‹ ë¢°í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤! ì´ì œ ìŠ¤íŠ¸ë¼ì´í”„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ì—¬ ì‹¤ì œë¡œ ê²°ì œê°€ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

![image](https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2020/10/verify-payment-stripe-dashboard.png?resize=730%2C191&ssl=1)

ëŒ€ì‹œë³´ë“œì˜ ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ë³´ê¸°ë¥¼ ì „í™˜í•œ ë‹¤ìŒ ê²°ì œ ì°½ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. ê²°ì œ ëª©ë¡ ìœ„ì— í…ŒìŠ¤íŠ¸ ë°ì´í„° ë ˆì´ë¸”ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤. ì´ ë¼ë²¨ì˜ ìµœì‹  í•­ëª©ì€ ì•±ì—ì„œ ë°©ê¸ˆ ìƒì„±í•œ í•­ëª©ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤! ë°©ê¸ˆ ê³µì§œë¡œ ëˆì„ ë²Œì—ˆêµ¬ë‚˜!

## ë§ˆê°ë°œì–¸

ìš°ë¦¬ê°€ í•¨ê»˜ ë†€ë¼ìš´ ì•±ì„ ë§Œë“¤ì—ˆì§€ë§Œ, ìš°ë¦¬ëŠ” ì´ê²ƒì´ ìš°ë¦¬ê°€ ì‹¤ì œ ì‚¬ìš©ìì˜ ì†ì— ë„£ì—ˆë˜ ê´‘íƒì´ ë‚˜ê±°ë‚˜ ì™„ì„±ëœ ì œí’ˆê³¼ëŠ” ê±°ë¦¬ê°€ ë©€ë‹¤ëŠ” ê²ƒì„ ì¸ì •í•´ì•¼ë§Œ í•œë‹¤. ê·¸ëŸ¼ ì§€ê¸ˆ í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²ƒ ì™¸ì— ê°œì„ í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ì‚¬í•­ì„ ê³„íší•´ ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?

- APIì—ì„œ ê²€ìƒ‰í•œ ì œí’ˆì˜ ì •ì  ì–´ë ˆì´ ì¸ì•±ì—ì„œ ë™ì  ì €ì¥ëœ ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ìœ¼ë¡œ ì œí’ˆ ëª©ë¡ ì´ë™
- ì´ë¯¸ì§€, ì„¤ëª…, ì œëª© ë“±ì„ ì¶”ê°€í•˜ì—¬ ì œí’ˆì„ í™”ë ¤í•˜ê²Œ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
- ê²°ì œ ëª©ë¡ ëì ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ êµ¬ì…í•œ ì œí’ˆ ëª©ë¡ í‘œì‹œ
- ì‚¬ìš©ìê°€ ì œí’ˆì„ êµ¬ì…í•˜ë©´ ì œí’ˆì— í‘œì‹œê¸°ë¥¼ í‘œì‹œí•˜ì—¬ ì´ë¯¸ êµ¬ì…í–ˆìŒì„ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ì‹­ì‹œì˜¤. ë˜í•œ êµ¬ì… ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ëŠ” ëŒ€ì‹  ì‚¬ìš©ìê°€ ì„ íƒí•œ ê²½ìš° ë™ì¼í•œ ì œí’ˆì„ ë‹¤ì‹œ êµ¬ì…í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
- ê²°ì œ ìš”ì²­ì´ ì„±ê³µí•œ ê²½ìš° ì„±ê³µ íŒì—… í‘œì‹œ

ì§€ê¸ˆê¹Œì§€ í•´ì˜¤ì…¨ë‹¤ë©´, 110%ëŠ” ë…ì ë¶„ ìŠ¤ìŠ¤ë¡œ ìœ„ì˜ ëª¨ë“  ê²ƒì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ê³  í™•ì‹ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì €ëŠ” ëª¨ë“  ì‚¬ëŒë“¤ì´ ê·¸ê²ƒì„ ì‹œë„í•´ ë³¼ ê²ƒì„ ê°•ë ¥íˆ ê¶Œí•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ë§Œì•½ ë‹¹ì‹ ì´ ë‹¹ì‹ ì˜ Gitrepoë‚˜ ìƒì ì— ê²Œì¬ëœ ì™„ì„±ëœ ì•±ìœ¼ë¡œ íŠ¸ìœ„í„°ë¥¼ í†µí•´ ë‚˜ì—ê²Œ ì†ì„ ë‚´ë°€ì–´ ìœ„ì˜ ëª¨ë“  ì•„ì´í…œì„ ì™„ì„±í•œë‹¤ë©´ ë‚˜ì—ê²Œ ì•Œë ¤ì£¼ì„¸ìš”!