---
layout: post
title: "동적 약속 체인"
author: "Logger"
thumbnail: "undefined"
tags: 
---


![Image for post](https://miro.medium.com/max/2732/1*3Lv_ke7T9sIfh7WKM1-MhA.png)

# 도입

오늘날 많은 개발자들은 약속의 아름다움과 그들이 제공하는 유연성을 깨닫지 못한다. 약속은 원격 소스에서 일부 데이터를 가져오는 데 사용되는 코드 조각과 마주치는 것은 매우 흔한 일이며, 이는 간단한 콜백 기능으로 구현될 수 있습니다. 반면에 그것의 목적은 훨씬 더 복잡하고 강력하다.

이 가이드에서, 저는 여러분이 얼마나 많은 사슬을 매겨야 하는지 미리 알지 못한 채 어떻게 약속을 하고, 무엇이 더 맛있고, 어떻게 역동적으로 그것을 할 수 있는지에 대한 제 지식을 나누고자 합니다.

우리 모두는 소위 콜백 지옥에 대해 들어본 적이 있다. 그것은 Promise API를 발명한 주요 동기 중 하나였다.

약속은 그러한 상황에 쉽게 대처할 수 있다.

![Image for post](https://miro.medium.com/max/1856/1*1rlNjMeVyQJhA0EdgJL1sw.png)

이런 종류의 예측 가능한 작업은 단 몇 초 만에 해결될 수 있다. 하지만 만약 우리의 과제가 그렇게 예측가능하지 않다면? 약속 사슬에서 몇 개가 있는지 미리 알지 못한 채 일련의 비동기 작업을 차례로 수행해야 한다면 어떨까요? 다시 말해, 어떻게 하면 동적으로 약속 사슬을 구축할 수 있을까요?

나는 그렇게 하기 위한 두 가지 접근법을 보여주고 싶다. 하지만 먼저, 작업할 수 있는 기반을 만들어 봅시다.

파일 다운로드 프로세스를 모방하는 간단한 기능도 있습니다.

이 점을 고려하십시오. 어떤 이유에서인지 모의 파일이 차례로 다운로드되기를 원합니다(실제로 이것은 일반적인 시나리오입니다). 이제 우리는 정확히 세 개의 파일이 있다는 것을 안다. 아까도 말했지만, 정적 데이터로 작업하기는 매우 쉬울 것입니다.

```undefined
const [file1,file2,file3] = mockFiles
다운로드(파일 1)
.then(_ => 다운로드(file2)
.then(_ => 다운로드(파일 3)
```

이건 아주 간단하죠? 하지만 상황이 역동적이고 예측할 수 없게 되면, 더 깊이 파고들 필요가 있습니다. 파일이 열 개면 어떻게 하고, 1000개면 어떻게 하죠? 외부 소스로부터 지침을 수신하고 다운로드해야 할 파일이 몇 개인지 알 수 없다고 가정해 보겠습니다. 가장 먼저 솔깃할 수 있는 것은 `약속`을 사용하는 것이다.모든 API

이 함수는 파일 수량에 의존하지 않는 도전을 받아들입니다. 하지만 그건 우리가 필요로 하는 것이 아니야. 우리의 목적과는 달리, 그것은 파일을 단계별로 다운로드하는 것이 아니라 병렬로 다운로드한다. 출력을 주의 깊게 관찰한 경우 이 함수는 원본 배열의 파일 순서에 상관하지 않을 수 있습니다. 그것은 가능한 한 빨리 그것들을 다운로드한다. 그래서 file_1에 대한 출력과 file_3에 대한 출력, file_2에 대한 출력만 보입니다. 여기서 주문은 파일 순서가 아니라 다운로드 시간을 기준으로 합니다.

# 재귀 약속 체인

## 재귀

첫 번째 접근법은 재귀에 기초한 약속 사슬을 구축하는 것이다. 이렇게 생겼습니다.

우리는 이미 예상된 행동을 볼 수 있다. 이 기능은 병렬 다운로드와 달리 파일 순서를 준수해 시간이 얼마가 걸리더라도 차례로 다운로드한다.

## 몇 가지 핵심 조각

# 환원 약속 사슬

## 배열.protype.reduce

두 번째 방법은 환원기 기능을 사용하는 것인데, 제 생각에는 이 기능이 더 유연하고 유지 관리가 쉽다고 생각합니다. 여기 있습니다:

## 몇 가지 핵심 조각

# 글로벌 체인

현재까지 세 가지 종류의 다운로드를 구현했습니다.

그리고 그거 알아? 그 무엇도 우리가 단지 재미로 그것들을 하나의 글로벌 체인에 묶는 것을 방해하지 않습니다.

콘솔의 출력을 확인하고 모든 것이 올바르게 작동하는지 확인하십시오.

# 결론

대부분의 경우, 환원 접근법이 이긴다. 특히:

언급할 가치가 있는 유일한 재귀는 다음과 같습니다.

읽어주셔서 감사합니다. 이 주제에 대해 좀 더 깊이 있게 의견을 나눌 수 있으면 좋겠습니다.